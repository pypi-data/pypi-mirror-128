(window["webpackJsonpparade-crossfilter"]=window["webpackJsonpparade-crossfilter"]||[]).push([[0],{17:function(e,t,n){},25:function(e,t,n){e.exports=n(40)},30:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(18),o=n.n(i),c=(n(30),n(1)),l=n(13),u=n(9),s=n(6),m=n.n(s),d=n(7),f=n(5),p=n(19),h=n(20),v=n(23),g=n(21),b=n(24),E=n(10);function y(e,t){fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.body.getReader()})).then((function(e){!function(e,t){var n=[];e.read().then((function a(r){var i=r.done,o=r.value;if(i)t(n.join(""));else{for(var c=0;c<o.length;c++)n.push(String.fromCharCode(o[c]));e.read().then(a)}}))}(e,t)}))}function w(e){return O.apply(this,arguments)}function O(){return(O=Object(d.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){return e}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=n(8);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function S(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function I(e){var t={};e.forEach((function(e){var n=e.link.parent.id,a=e.link.parent.class.slice(0,-1);t[n]||(t[n]={}),e.values.forEach((function(e){t[n][e[0]]=e[1]})),t[n][a]=n}));var n=Object.keys(t).map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t[e])})),a=n.reduce((function(e,t){return Object.keys(t).forEach((function(t){e.add(t)})),e}),new Set),r=[],i=!0,o=!1,c=void 0;try{for(var l,u=a.values()[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var s=l.value;r.push(s)}}catch(m){o=!0,c=m}finally{try{i||null==u.return||u.return()}finally{if(o)throw c}}return D(n,r)}function D(e,t){t||(t=Object.keys(e[0]));var n=t.map((function(e){var t=e.trim();return"image_id"===t&&(t="Image"),"roi_id"===t&&(t="ROI"),"shape_id"===t&&(t="Shape"),"well_id"===t&&(t="Well"),{name:t,origName:e,type:void 0,empty:!0}})),a=e.map((function(e,t){var a=!0;return n.forEach((function(t){if(e[t.origName]&&0!==e[t.origName].length){a=!1,t.empty=!1;var n=e[t.origName];if("number"===t.type){var r=+n;isNaN(r)||(n=r)}else if(void 0===t.type){var i=+n;isNaN(i)?t.type="string":(t.type="number",n=i)}e[t.name]=n}})),!a&&(e._rowID=t,e)})).filter(Boolean);return{columns:n=n.filter((function(e){return!e.empty})),parsedData:a}}function N(e,t){var n;return void 0!==t&&("number"==typeof(n=t)&&isFinite(n)&&n%1===0)||(t=2),e<1024?e+" B":e<1048576?(e/1024).toFixed(t)+" KB":e<1073741824?(e/1048576).toFixed(t)+" MB":e<1099511627776?(e/1073741824).toFixed(t)+" GB":e<0x4000000000000?(e/1099511627776).toFixed(t)+" TB":(e/0x4000000000000).toFixed(t)+" PB"}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var C=r.a.createContext("CXContext"),_=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(v.a)(this,Object(g.a)(t).call(this,e))).chars=[],n.state={loading:!1,hasNDX:!1,groupBy:[]},n.toLoad=e.toLoad,n}return Object(b.a)(t,e),Object(h.a)(t,[{key:"addGroupBy",value:function(e){var t=this,n=function(e,t,n){var a=Object(x.default)(e.all()).dimension((function(e){return e[n]})).group();t=t.filter((function(e){return"number"===e.type})),a.reduce((function(e,n){return t.forEach((function(t){e[t.name]=e[t.name]+n[t.name]})),e.count=e.count+1,e}),(function(e,n){return t.forEach((function(t){e[t.name]=e[t.name]-n[t.name]})),e.count=e.count-1,e}),(function(){var e={count:0};return t.forEach((function(t){e[t.name]=0})),e}));var r="Rows per "+n,i={},o=a.all().map((function(e,a){var o={_rowID:a};return o[n]=e.key,o[r]=e.value.count,t.forEach((function(t){o[t.name]=e.value[t.name]/e.value.count,i[t.name]||Number.isInteger(o[t.name])||(i[t.name]=!0)})),o})),c=["Screen","Plate","Well","Project","Dataset","Image","ROI","Shape"].filter((function(e){return i[e]}));return t=t.filter((function(e){return-1===c.indexOf(e.name)})),o=o.map((function(e){return c.forEach((function(t){delete e[t]})),e})),t.splice(1,0,{name:r,type:"number"}),{columns:t,data:o}}(this.orig_data,this.columns,e);this.orig_data=Object(x.default)(n.data),this.columns=n.columns,this.setState({hasNDX:!1,loading:!0}),setTimeout((function(){t.setState({hasNDX:!0,loading:!1})}),100)}},{key:"initCrossfilter",value:function(e,t,n){var a,r;if(e){var i=D(e);a=i.columns,r=i.parsedData}else if(n){var o=I(n);a=o.columns,r=o.parsedData}if(t){var c={};t.forEach((function(e){c[e.image.id]=e.dataset})),a.push({name:"Dataset",type:"string"}),r=r.map((function(e){return e.image_id&&c[e.Image]?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{Dataset:c[e.Image].name}):e}))}this.orig_data=Object(x.default)(r),this.columns=a,this.ndx=this.orig_data,this.setState({loading:!1,hasNDX:!0})}},{key:"componentDidMount",value:function(){var e=this;this.state.hasNDX||(this.state.loading||(this.setState({loading:!0}),function(){var t=Object(d.a)(m.a.mark((function t(){var n,a,r,i,o,c,l,u,s,d,f,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.toLoad.datasets){t.next=7;break}return a=e.toLoad.datasets,r=window.OMEROWEB_INDEX+"parade_crossfilter/datasets/".concat(a),t.next=5,w(r);case 5:i=t.sent,n=i.data;case 7:if(!e.toLoad.mapAnns){t.next=17;break}return c=e.toLoad.mapAnns,l=c.split("-")[1],u=c.split("-")[0],s="project"===u?"images":"wells",d=window.OMEROWEB_INDEX+"parade_crossfilter/annotations/".concat(u,"/").concat(l,"/").concat(s,"/?type=map"),t.next=15,w(d);case 15:f=t.sent,o=f.annotations;case 17:e.toLoad.csvFiles&&e.toLoad.csvFiles.length>0?(p=e.toLoad.csvFiles[0],y(window.OMEROWEB_INDEX+"webclient/annotation/".concat(p),(function(t){e.initCrossfilter(E.csvParse(t),n)}))):e.initCrossfilter(void 0,n,o);case 18:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()))}},{key:"render",value:function(){var e=this;if(!this.state.hasNDX)return r.a.createElement("div",null,"Loading...");var t=this.orig_data,n=this.columns;return r.a.createElement(C.Provider,{value:{ndx:t,columns:n,addGroupBy:function(t){e.addGroupBy(t)}}},r.a.createElement("div",{ref:this.parent},this.props.children))}}]),t}(r.a.Component),F=function(e){var t=r.a.useContext(C);return r.a.createElement("select",{value:"--",onChange:function(n){var a=n.target.value,r=t.columns.find((function(e){return e.name===a}));e.addFilter(r)},style:{margin:10,width:"calc(100% - 20px)"}},r.a.createElement("option",{value:"--"},"Add Filter"),t.columns.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))},P=n(3),B=function(e){var t=e.chart,n=e.isFiltered;return r.a.createElement("button",{type:"button",className:"btn btn-light btn-sm",style:{position:"absolute",right:0,opacity:n?1:0},onClick:function(){t.filterAll(),P.redrawAll()}},"reset")},M=function(e){var t=r.a.useContext(C),n=r.a.useState(null),a=Object(c.a)(n,2),i=a[0],o=a[1],l=r.a.useState(!1),u=Object(c.a)(l,2),s=u[0],m=u[1],d=t.ndx,f=r.a.useRef(null),p=e.dimName,h=e.chartFunction,v=e.setSubheading;r.a.useEffect((function(){var e=h(f.current,d,p);return e.render(),e.on("filtered",(function(e,t){if(m(null!=t),t&&"RangedFilter"===t.filterType){var n=t?"".concat(t[0].toFixed(2)," - ").concat(t[1].toFixed(2)):"";v(n)}})),o(e),function(){e.dimension().dispose(),P.redrawAll()}}),[]);return r.a.createElement("div",{ref:f,style:{width:"100%",height:"auto",boxSizing:"border-box",padding:0,position:"relative"}},r.a.createElement(B,{isFiltered:s,chart:i}))},R=function(e,t,n){var a=t.dimension((function(e){return e[n]})),r=1.01*a.top(1)[0][n],i=a.bottom(1)[0][n],o=(r-i)/20,c=a.group((function(e){return Math.floor(e/o)*o})),l=P.barChart(e);return l.dimension(a).group(c).x(Object(E.scaleLinear)().domain([i,r])).xUnits((function(){return 20})).centerBar(!0).elasticY(!0).xAxis(),l},W=function(e){return r.a.createElement(M,{chartFunction:R,setSubheading:e.setSubheading,dimName:e.dimName})},X=function(e){var t=r.a.useContext(C).ndx,n=r.a.useRef(null),a=e.dimName;r.a.useEffect((function(){var e=function(e,t,n){var a=P.rowChart(e),r=t.dimension((function(e){return e[n]})),i=r.group();return a.dimension(r).group(i),a}(n.current,t,a);return e.render(),function(){e.dimension().dispose(),P.redrawAll()}}),[a,t]);return r.a.createElement("div",{ref:n,style:{width:"100%",height:"auto",boxSizing:"border-box",padding:0,position:"relative"}})},A=function(e){var t=e.dimName,n=r.a.useContext(C),a=r.a.useState(""),i=Object(c.a)(a,2),o=i[0],l=i[1],u=r.a.useState(null),s=Object(c.a)(u,2),m=s[0],d=s[1],f=n.ndx;r.a.useEffect((function(){var e=f.dimension((function(e){return e[t]}));return d(e),function(){e.dispose(),P.redrawAll()}}),[t,f]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"text",placeholder:"Filter by ".concat(t),className:"form-control",value:o,onChange:function(e){var t=e.target.value;l(t),m.filter((function(e){return e.indexOf(t)>-1})),P.redrawAll()}}),r.a.createElement(X,{dimName:t}))},L=function(e){var t=e.dimName,n=e.dimType,i=e.removeFilter,o=Object(a.useState)(""),l=Object(c.a)(o,2),u=l[0],s=l[1];return r.a.createElement("div",{className:"toast show",role:"alert","aria-live":"assertive","aria-atomic":"true"},r.a.createElement("div",{className:"toast-header"},r.a.createElement("strong",{className:"mr-auto"},t),r.a.createElement("small",{className:"text-muted"},u),r.a.createElement("button",{type:"button",className:"ml-2 mb-1 close","data-dismiss":"toast","aria-label":"Close",onClick:function(){i(t)}},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),r.a.createElement("div",{className:"toast-body"},"number"===n?r.a.createElement(W,{dimName:t,setSubheading:s}):r.a.createElement(A,{dimName:t})))},z=function(){var e=r.a.useState([]),t=Object(c.a)(e,2),n=t[0],a=t[1],i=function(e){a(n.filter((function(t){return t.name!==e})))};return r.a.createElement("div",{className:"sidebar-sticky"},r.a.createElement("h6",{className:"sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"},r.a.createElement("span",null,"Filters")),r.a.createElement(F,{addFilter:function(e){n.find((function(t){return t.name===e.name}))||a(n.concat(e))}}),r.a.createElement("div",{style:{padding:10}},n.map((function(e){return r.a.createElement(L,{key:e.name,removeFilter:i,dimType:e.type,dimName:e.name})}))))},T=function(){var e=r.a.useContext(C),t=e.columns.filter((function(e){return"number"===e.type}));return r.a.createElement("select",{value:"--",onChange:function(t){var n=t.target.value;e.addGroupBy(n)},style:{margin:10,width:"calc(100% - 20px)"}},r.a.createElement("option",{value:"--"},"Add Group-by"),t.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))},G=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h6",{className:"sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted"},r.a.createElement("span",null,"Group By")),r.a.createElement(T,null))};n(16),n(17);var H=function(){var e=Object(a.useState)(!0),t=Object(c.a)(e,2),n=t[0],i=t[1],o={zIndex:100,padding:"0",boxShadow:"inset -1px 0 0 rgba(0, 0, 0, .1)",display:"block",flexGrow:0,flexShrink:0,width:n?320:0,transition:"width 0.5s ease-in-out"},s={transform:n?"rotate(0deg)":"rotate(180deg)"};return r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"bg-light",style:o},r.a.createElement(G,null),r.a.createElement(z,null)),r.a.createElement("nav",{className:"bg-light",style:{zIndex:110,padding:"0",boxShadow:"inset -1px 0 0 rgba(0, 0, 0, .1)",display:"block",flex:"0 0 50px"}},r.a.createElement("div",{className:"sidebar-sticky",style:{padding:7}},r.a.createElement("button",{onClick:function(){i(!n)},type:"button",className:"btn btn-light",style:s},r.a.createElement(l.a,{icon:u.a})))))},K=n(11);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J={cursor:"pointer"},Y=function(e){var t=e.selectedIds,n=e.setSelectedIds,a=e.sortBy,i=e.setSortBy,o=e.sortReverse,s=e.setSortReverse,m=r.a.useContext(C),d=m.columns.map((function(e){return e.name})),f=r.a.useState([]),p=Object(c.a)(f,2),h=p[0],v=p[1],g=m.ndx;r.a.useEffect((function(){v(g.allFiltered());var e=g.onChange((function(e){v(g.allFiltered())}));return function(){e()}}),[g]);var b=r.a.useRef(null);if(r.a.useEffect((function(){if(t.length>0){var e=h.map((function(e){return e._rowID})),n=t.map((function(t){return e.indexOf(t)}));b.current.scrollToItem({align:"center",rowIndex:n[0]})}}),[t,a,o]),a){var E=o?-1:1;h.sort((function(e,t){var n=void 0===e[a]?"":e[a],r=void 0===t[a]?"":t[a];return n===r?0:n>r?E:-E}))}var y=function(e){return t.indexOf(h[e]._rowID)>-1};return r.a.createElement("div",null,r.a.createElement(K.a,{height:35,columnCount:d.length,columnWidth:100,rowCount:1,rowHeight:35,width:100*d.length+20},(function(e){var t,n=e.columnIndex,c=(e.rowIndex,e.style);return r.a.createElement("div",{style:U({},c,{},J),onClick:function(){return a===d[e=n]?s(!o):s(!1),void i(d[e]);var e}},d[n],r.a.createElement(l.a,{icon:(t=d[n],t!==a?u.b:o?u.d:u.c),style:{marginLeft:3}}))})),r.a.createElement(K.a,{ref:b,height:250,columnCount:d.length,columnWidth:100,rowCount:h.length,rowHeight:35,width:100*d.length+20},(function(e){var t=e.columnIndex,a=e.rowIndex,i=e.style;return r.a.createElement("div",{style:U({},i,{background:y(a)?"#b1b3f4":"white",padding:5}),onClick:function(){return function(e){if(y(e))n([]);else{var t=h[e]._rowID;n([t])}}(a)},className:"table_cell",title:h[a][d[t]]},h[a][d[t]],"Image"===d[t]&&r.a.createElement("img",{alt:"Thumbnail",src:"".concat(window.OMEROWEB_INDEX,"webclient/render_thumbnail/").concat(h[a][d[t]],"/")}),"Shape"===d[t]&&r.a.createElement("img",{alt:"Shape Thumbnail",src:"".concat(window.OMEROWEB_INDEX,"webgateway/render_shape_thumbnail/").concat(h[a][d[t]],"/?color=ff0")}))})))},$=n(22),q=n.n($);function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ee=function(e){var t=e.data,n=e.layout,a=e.onSelected,i=r.a.useState(void 0),o=Object(c.a)(i,2),l=o[0],u=o[1],s=r.a.useState(void 0),m=Object(c.a)(s,2),d=m[0],f=m[1],p=r.a.useState(n.xaxis.title.text),h=Object(c.a)(p,2),v=h[0],g=h[1],b=r.a.useState(n.yaxis.title.text),E=Object(c.a)(b,2),y=E[0],w=E[1];r.a.useEffect((function(){var e=n.xaxis.title.text,t=n.yaxis.title.text;v===e&&y===t||(u(void 0),f(void 0),g(e),w(t))}),[n,v,y]);var O=Z({},n.xaxis,{range:l}),x=Z({},n.yaxis,{range:d}),j=Z({},n,{xaxis:O,yaxis:x});return r.a.createElement("div",null,r.a.createElement(q.a,{data:t,layout:j,onUpdate:function(e,t){u(e.layout.xaxis.range),f(e.layout.yaxis.range)},onSelected:a}))},te=function(e){var t=e.xAxis,n=e.yAxis,a=e.groupBy,i=e.selectedIds,o=e.setSelectedIds,l=r.a.useContext(C).ndx,u=r.a.useState([]),s=Object(c.a)(u,2),m=s[0],d=s[1],f=[];if(a){var p={};m.forEach((function(e){var r=e[a];p[r]||(p[r]=[]),p[r].push({x:e[t],y:e[n],id:e._rowID})}));var h=Object.keys(p);h.sort(),f=h.map((function(e){var t=p[e];return t.sort((function(e,t){return e.x>t.x?1:e.x<t.x?-1:0})),{x:t.map((function(e){return e.x})),y:t.map((function(e){return e.y})),customdata:t.map((function(e){return e.id})),type:"scattergl",mode:"lines+markers",name:e}}))}else{var v={selected:[]," ":[]};m.forEach((function(e){e[a];i.indexOf(e._rowID)>-1?v.selected.push({x:e[t],y:e[n],id:e._rowID}):v[" "].push({x:e[t],y:e[n],id:e._rowID})})),f=[" ","selected"].map((function(e){var t=v[e];return{x:t.map((function(e){return e.x})),y:t.map((function(e){return e.y})),customdata:t.map((function(e){return e.id})),type:"scattergl",mode:"markers",name:e,marker:{color:"selected"===e?"red":"rgb(31, 119, 180)"}}}))}return r.a.useEffect((function(){d(l.allFiltered());var e=l.onChange((function(e){d(l.allFiltered())}));return function(){e()}}),[t,n,a,l]),0===f.length?r.a.createElement("div",null,"No data"):r.a.createElement("div",null,r.a.createElement(ee,{data:f,layout:{showlegend:Boolean(a),width:520,height:340,xaxis:{title:{text:t,font:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}},yaxis:{title:{text:n,font:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}}},onSelected:function(e){if(e&&e.points){var t=e.points.map((function(e){return e.customdata}));o(t)}}}))},ne=function(e){var t=e.xAxis,n=e.yAxis,a=r.a.useContext(C).ndx,i=r.a.useState([]),o=Object(c.a)(i,2),l=o[0],u=o[1],s=function(e){var a={};e.forEach((function(e){var r=e[t];a[r]||(a[r]=[]),a[r].push(e[n])}));var r=Object.keys(a);r.sort();var i=r.map((function(e){return{y:a[e],type:"box",name:e}}));u(i)};return r.a.useEffect((function(){s(a.allFiltered());var e=a.onChange((function(e){s(a.allFiltered())}));return function(){e()}}),[t,n,a]),0==l.length?r.a.createElement("div",null,"No data"):r.a.createElement("div",null,r.a.createElement(ee,{data:l,layout:{showlegend:!1,width:520,height:340,xaxis:{title:{text:t,font:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}},yaxis:{title:{text:n,font:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}}}}))},ae=function(e){var t=e.selectedIds,n=e.setSelectedIds,a=r.a.useContext(C),i=a.columns.filter((function(e){return"number"===e.type})),o=a.columns.filter((function(e){return"number"!==e.type})),l=r.a.useState(i[0]),u=Object(c.a)(l,2),s=u[0],m=u[1],d=o[0];i.length>1&&(d=i[1]);var f=r.a.useState(d),p=Object(c.a)(f,2),h=p[0],v=p[1],g=r.a.useState(void 0),b=Object(c.a)(g,2),E=b[0],y=b[1];if(0===i.length)return r.a.createElement("div",null,"No number columns: plot not available");return r.a.createElement("div",{style:{position:"relative",paddingTop:30}},"number"===h.type?r.a.createElement(te,{xAxis:h.name,yAxis:s.name,groupBy:E,selectedIds:t,setSelectedIds:n}):r.a.createElement(ne,{xAxis:h.name,yAxis:s.name,setSelectedIds:n}),r.a.createElement("div",{style:{position:"absolute",top:10,left:10}},r.a.createElement("label",null,"Y axis:"),r.a.createElement("select",{onChange:function(e){var t=e.target.value,r=a.columns.find((function(e){return e.name===t}));m(r),n([])},value:s.name},i.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)}))),r.a.createElement("label",null,"X axis:"),r.a.createElement("select",{onChange:function(e){var t=e.target.value,r=a.columns.find((function(e){return e.name===t}));v(r),n([])},value:h.name},r.a.createElement("optgroup",{label:"Scatter Plot"},i.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)}))),r.a.createElement("optgroup",{label:"Box and whisker Plot"},o.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))),r.a.createElement("label",null,"Group by:"),r.a.createElement("select",{onChange:function(e){var t=e.target.value;"-"===t&&(t=void 0),y(t)}},r.a.createElement("option",{value:"-"},"-"),a.columns.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))))},re=function(e){var t=e.imgData,n=e.size,a=e.x,i=e.y,o=t.id,c=t.size.width/t.size.height,l=192,u=192;return c>1?u=192/c:l=192*c,r.a.createElement("div",{style:{width:l,height:u,position:"relative",display:"inline-block"}},r.a.createElement("img",{style:{width:l,height:u,position:"absolute",top:0,left:0},src:window.OMEROWEB_INDEX+"webclient/render_thumbnail/".concat(o),alt:"Bird's eye view"}),r.a.createElement("div",{style:{position:"absolute",border:"solid yellow 1px",left:l*a/t.size.width,top:u*i/t.size.height,width:n*l/t.size.width,height:n*u/t.size.height}}))},ie=function(e){var t=e.imgData,n=e.roiData,a=e.rowData,i=t.id,o=r.a.useState(400),l=Object(c.a)(o,2),u=l[0],s=l[1],m=r.a.useState({x:0,y:0}),d=Object(c.a)(m,2),f=d[0],p=d[1];r.a.useEffect((function(){var e;if(t.tiles)if(n){var a=function(e){if(e.shapes[0]&&e.shapes[0].Points){var t=e.shapes[0].Points.split(" ").map((function(e){return e.split(",")})),n=t.map((function(e){return parseFloat(e[0])})),a=t.map((function(e){return parseFloat(e[1])})),r=n.reduce((function(e,t){return Math.min(e,t)})),i=n.reduce((function(e,t){return Math.max(e,t)})),o=a.reduce((function(e,t){return Math.min(e,t)}));return{x:r,y:o,width:i-r,height:a.reduce((function(e,t){return Math.max(e,t)}))-o}}}(n);e=Math.max(a.width,a.height),e=Math.max(3*e,u);var r=a.x+a.width/2,i=a.y+a.height/2;s(e),p({x:r,y:i})}else e=Math.max(t.size.width,t.size.height),s(e),p({x:t.size.width/2,y:t.size.height/2})}),[t,n]);var h,v,g,b,E=function(e){"+"===e.target.value?s(u/2):s(2*u)};return t.tiles?(v=u,g=f.x-v/2,b=f.y-v/2,h=window.OMEROWEB_INDEX+"figure/render_scaled_region/".concat(i,"/0/0/?region=").concat(g,",").concat(b,",").concat(v,",").concat(v)):h=Number.isInteger(a.Shape)?window.OMEROWEB_INDEX+"webgateway/render_shape_thumbnail/".concat(a.Shape,"/?color=ff0"):window.OMEROWEB_INDEX+"webclient/render_image/".concat(i,"/"),r.a.createElement("div",null,r.a.createElement("img",{style:{width:350,float:"left"},alt:"Full rendered plane",src:h}),t.tiles&&r.a.createElement("span",null,r.a.createElement("button",{value:"-",onClick:E},"-"),r.a.createElement("button",{value:"+",onClick:E},"+"),r.a.createElement("br",null),r.a.createElement(re,{imgData:t,size:v,x:g,y:b})))},oe=function(e){var t=e.rowData,n=r.a.useState(void 0),a=Object(c.a)(n,2),i=a[0],o=a[1],l=r.a.useState(void 0),u=Object(c.a)(l,2),s=u[0],f=u[1],p=r.a.useState(void 0),h=Object(c.a)(p,2),v=h[0],g=h[1];return r.a.useEffect((function(){function e(){return(e=Object(d.a)(m.a.mark((function e(){var n,a,r,i,c,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Number.isInteger(t.ROI)){e.next=6;break}return n=window.OMEROWEB_INDEX+"api/v0/m/rois/".concat(t.ROI,"/"),e.next=4,w(n);case 4:a=e.sent,f(a.data);case 6:if(!Number.isInteger(t.Image)){e.next=14;break}return r=window.OMEROWEB_INDEX+"webclient/imgData/".concat(t.Image,"/"),e.next=10,w(r);case 10:i=e.sent,o(i),e.next=20;break;case 14:if(!Number.isInteger(t.Well)){e.next=20;break}return c=window.OMEROWEB_INDEX+"api/v0/m/wells/".concat(t.Well,"/"),e.next=18,w(c);case 18:l=e.sent,g(l);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o(void 0),function(){e.apply(this,arguments)}()}),[t]),r.a.createElement("div",null,i?r.a.createElement("div",null,r.a.createElement("p",null,i.meta.imageName),r.a.createElement(ie,{imgData:i,roiData:s,rowData:t})):v?r.a.createElement("div",null,v.data.WellSamples.map((function(e){return r.a.createElement("img",{src:window.OMEROWEB_INDEX+"webclient/render_image/".concat(e.Image["@id"],"/0/0/"),style:{maxWidth:250,margin:5},alt:""})}))):r.a.createElement("div",null,"Loading..."))};function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ue={padding:2,height:"100%",maxWidth:"100%",maxHeight:"100%"},se=function(e){var t=e.selectedIds,n=e.setSelectedIds,a=e.sortBy,i=e.sortReverse,o=r.a.useContext(C),l=r.a.useState([]),u=Object(c.a)(l,2),s=u[0],m=u[1],d=o.ndx,f=o.columns;r.a.useEffect((function(){m(d.allFiltered());var e=d.onChange((function(e){m(d.allFiltered())}));return function(){e()}}),[d]);var p=s;if(t.length>0&&(p=s.filter((function(e){return t.indexOf(e._rowID)>-1}))),a){var h=i?-1:1;p.sort((function(e,t){return e[a]>t[a]?h:-h}))}var v=function(e){return e.Shape?"".concat(window.OMEROWEB_INDEX,"webgateway/render_shape_thumbnail/").concat(e.Shape,"/?color=ff0"):e.Image?"".concat(window.OMEROWEB_INDEX,"webclient/render_thumbnail/").concat(e.Image,"/"):""},g=function(e){return f.map((function(e){return e.name})).filter((function(t){return(""+e[t]).length>0})).map((function(t){return"".concat(t,": ").concat(e[t])})).join("   ")};if(1===t.length){var b=t[0],E=p.filter((function(e){return e._rowID===b}));if(1===E.length)return r.a.createElement(oe,{rowData:E[0]})}return r.a.createElement("div",null,r.a.createElement("h6",{className:"text-muted px-3",style:{marginTop:"0.7rem"}},p.length,t.length>0?" selected":" rows"),r.a.createElement(K.a,{height:500,columnCount:2,columnWidth:250,rowCount:Math.ceil(p.length/2),rowHeight:170,width:510},(function(e){var t=e.columnIndex,a=e.rowIndex,i=e.style,o=p[2*a+t];return o?r.a.createElement("div",{style:le({},i)},r.a.createElement("img",{title:g(o),onClick:function(){return n([o._rowID])},alt:"",style:ue,src:v(o)})):r.a.createElement("span",null)})))},me=function(){var e=r.a.useContext(C).ndx,t=r.a.useState(0),n=Object(c.a)(t,2),a=n[0],i=n[1];return r.a.useEffect((function(){i(e.allFiltered().length);var t=e.onChange((function(t){i(e.allFiltered().length)}));return function(){t()}}),[e]),r.a.createElement("span",{className:"navbar-brand col-sm-3 col-md-2 mr-0"},"OMERO.parade",r.a.createElement("span",{style:{marginLeft:20}},"Filtering ",a," / ",e.all().length))},de=function(e){var t=e.wellSample,n=e.rows,a=e.heatmap,i=e.heatmapMin,o=e.heatmapMax,c=e.setSelectedIds,l=(t.Image["@id"],{opacity:n&&n.length>0?1:.1,width:15,height:15,float:"left",margin:1}),u=function(){c(n.map((function(e){return e._rowID})))},s=function(e){if(0===e.length||"--"===a)return"";var t=e.map((function(e){return e[a]})).filter((function(e){return!isNaN(e)}));return t.reduce((function(e,t){return e+t}),0)/t.length}(n),m="".concat(s," (").concat(n.length," rows)");return l.background=function(e){var t=(e-i)/(o-i),n=0,a=0;return t>.5&&(n=parseInt(256*(t-.5)*2)),t<.5&&(a=parseInt(2*(.5-t)*256)),"rgba("+[n,a,0,1].join(",")+")"}(s),r.a.createElement("div",{onClick:u,title:m,style:l})},fe=function(e){var t=e.well,n=e.showFields,a=e.rows,i=e.heatmap,o=e.heatmapMin,c=e.heatmapMax,l=e.setSelectedIds;if(n){var u={};if(a)for(var s=0;s<a.length;s++){var m=a[s];u[m.Image]||(u[m.Image]=[]),u[m.Image].push(m)}return r.a.createElement(r.a.Fragment,null,t.WellSamples.map((function(e){return r.a.createElement(de,{key:e.Image["@id"],wellSample:e,rows:u[e.Image["@id"]]||[],heatmap:i,heatmapMin:o,heatmapMax:c,setSelectedIds:l})})))}return r.a.createElement(de,{wellSample:t.WellSamples[0],rows:a,heatmap:i,heatmapMin:o,heatmapMax:c,setSelectedIds:l})},pe=function(e){var t=e.plate,n=e.showFields,i=e.heatmap,o=e.selectedIds,l=e.setSelectedIds,u=Object(a.useState)([]),s=Object(c.a)(u,2),m=s[0],d=s[1],f=r.a.useState([]),p=Object(c.a)(f,2),h=p[0],v=p[1],g=r.a.useContext(C).ndx;r.a.useEffect((function(){v(g.allFiltered());var e=g.onChange((function(e){v(g.allFiltered())}));return function(){e()}}),[g]),Object(a.useEffect)((function(){var e=window.OMEROWEB_INDEX+"api/v0/m/plates/".concat(t.id,"/wells/");fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){d(e.data)}))}),[t]);var b={},E=-1,y=-1;m.forEach((function(e){var t=e.Row,n=e.Column;E=Math.max(E,t),y=Math.max(y,n),b[t]||(b[t]={}),b[t][n]=e}));for(var w={},O=0;O<h.length;O++){var x=h[O],j=x.Well;j&&(w[j]||(w[j]=[]),w[j].push(x))}for(var S=[],I=0;I<=E;I++){for(var D=[],N=0;N<=y;N++)b[I]&&b[I][N]?D.push(b[I][N]):D.push({"@id":I});S.push(D)}var k,_,F=function(e){var t=w[e];if(!t)return!1;var n=t.map((function(e){return e._rowID})),a=o.reduce((function(e,t){return e||n.indexOf(t)>-1}),!1);return a};if("--"!==i){var P=g.dimension((function(e){return e[i]}));k=P.bottom(1)[0][i],_=P.top(1)[0][i]}return r.a.createElement("div",null,r.a.createElement("div",null,t.Name," (",m.length," Wells) "),r.a.createElement("table",{className:"plateGrid"},r.a.createElement("tbody",null,S.map((function(e){return r.a.createElement("tr",{key:e[0]["@id"]},e.map((function(e){return r.a.createElement("td",{key:e["@id"],style:{background:F(e["@id"])?"rgb(177, 179, 244)":""}},r.a.createElement(fe,{well:e,showFields:n,heatmap:i,heatmapMin:k,heatmapMax:_,rows:w[e["@id"]]||[],selectedIds:o,setSelectedIds:l}))})))})))))},he=function(e){var t=e.setShowFields,n=e.heatmap,a=e.setHeatmap,i=r.a.useState([]),o=Object(c.a)(i,2),l=(o[0],o[1]),u=r.a.useContext(C),s=u.ndx;r.a.useEffect((function(){l(s.allFiltered());var e=s.onChange((function(e){l(s.allFiltered())}));return function(){e()}}),[s]);var m=u.columns.filter((function(e){return"number"===e.type})),d="";if("--"!==n){var f=s.dimension((function(e){return e[n]}));d=parseInt(f.bottom(1)[0][n])+" - "+parseInt(f.top(1)[0][n])}return r.a.createElement("div",{style:{position:"absolute",width:350,top:0,right:0}},r.a.createElement("label",null,"Fields:",r.a.createElement("input",{type:"checkbox",onChange:function(e){t(e.target.checked)}}),"Heatmap:",r.a.createElement("select",{value:n,onChange:function(e){a(e.target.value)},style:{margin:5}},r.a.createElement("option",{value:"--"},"-"),m.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})),r.a.createElement("option",{value:"rowcount"},"Row Count")),d))},ve=function(e){var t=e.screenId,n=e.selectedIds,i=e.setSelectedIds,o=Object(a.useState)([]),l=Object(c.a)(o,2),u=l[0],s=l[1],m=Object(a.useState)(!1),d=Object(c.a)(m,2),f=d[0],p=d[1],h=r.a.useState("--"),v=Object(c.a)(h,2),g=v[0],b=v[1];return Object(a.useEffect)((function(){var e=window.OMEROWEB_INDEX+"api/v0/m/screens/".concat(t,"/plates/");fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){var t=e.data.map((function(e){return{id:e["@id"],Name:e.Name}}));s(t)}))}),[t]),r.a.createElement("div",{style:{position:"relative"}},r.a.createElement(he,{setShowFields:p,heatmap:g,setHeatmap:b}),0===u.length?"Loading plates...":"".concat(u.length," plates:"),u.map((function(e){return r.a.createElement(pe,{key:e.id,plate:e,showFields:f,heatmap:g,selectedIds:n,setSelectedIds:i})})))};var ge=function(e){var t=e.toLoad,n=e.screen,a=r.a.useState([]),i=Object(c.a)(a,2),o=i[0],l=i[1],u=r.a.useState(void 0),s=Object(c.a)(u,2),m=s[0],d=s[1],f=r.a.useState(!1),p=Object(c.a)(f,2),h=p[0],v=p[1];return r.a.createElement(_,{toLoad:t},r.a.createElement("nav",{className:"navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow"},r.a.createElement(me,null)),r.a.createElement("div",{style:{display:"flex",flexWrap:"nowrap",position:"absolute",top:48,height:"calc(100% - 48px)",bottom:0,width:"100%"}},r.a.createElement(H,null),r.a.createElement("main",{className:"column",style:{flex:"1 1 auto",paddingLeft:15,paddingRight:15,display:"flex",flexDirection:"column",width:"200",overflow:"auto"}},r.a.createElement("div",{style:{height:300,background:"",flex:"1 1 auto",display:"flex",flexDirection:"row"}},r.a.createElement("div",{style:{flex:"1 1 50%"}},n&&r.a.createElement(ve,{screenId:n,selectedIds:o,setSelectedIds:l}),r.a.createElement(ae,{selectedIds:o,setSelectedIds:l})),r.a.createElement("div",{style:{flex:"1 1 50%",overflow:"auto"}},r.a.createElement(se,{selectedIds:o,setSelectedIds:l,sortBy:m,sortReverse:h}))),r.a.createElement("div",{style:{overflow:"auto",flexGrow:0,flexShrink:0,height:310}},r.a.createElement(Y,{setSelectedIds:l,selectedIds:o,sortBy:m,setSortBy:d,sortReverse:h,setSortReverse:v})))))},be={display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridTemplateRows:"1fr",gridColumnGap:0,gridRowGap:0};var Ee=function(e){var t=e.project,n=e.screen,i=e.setDataToLoad,o=Object(a.useState)(!1),l=Object(c.a)(o,2),u=l[0],s=l[1],m=Object(a.useState)([]),d=Object(c.a)(m,2),f=d[0],p=d[1],h=Object(a.useState)(void 0),v=Object(c.a)(h,2),g=v[0],b=v[1],E=Object(a.useState)(void 0),y=Object(c.a)(E,2),w=y[0],O=y[1],x=Object(a.useState)(void 0),j=Object(c.a)(x,2),S=j[0],I=j[1];Object(a.useEffect)((function(){s(!0);var e=window.OMEROWEB_INDEX+"webclient/api/annotations/?type=file";t?e+="&project=".concat(t):n&&(e+="&screen=".concat(n)),fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){s(!1);var t=e.annotations.filter((function(e){return e.file&&e.file.name.endsWith(".csv")}));p(t)}))}),[t,n]);var D=function(e){var t=parseInt(e.target.value);g===t&&(t=void 0),b(t)};return r.a.createElement("div",{className:"App",style:{padding:"80px 150px"}},r.a.createElement("h1",null,t&&"Project",n&&"Screen"),r.a.createElement("div",{style:be},r.a.createElement("div",null,r.a.createElement("h3",null,"CSV files"),u?"Loading...":r.a.createElement("form",null,f.map((function(e){return r.a.createElement("div",{key:e.id},r.a.createElement("label",null,r.a.createElement("input",{type:"radio",name:"csv",value:e.id,onChange:function(){},onClick:D,checked:g===e.id}),e.id,": ",e.file.name," (",N(e.file.size),")"))})),r.a.createElement("button",{onClick:function(e){e.preventDefault();var t={};g&&(t.csvFiles=[g]),t.datasets=w,t.mapAnns=S,i(t)},type:"submit"},"OK"))),r.a.createElement("div",null,r.a.createElement("h3",null,"Key-Value Pairs"),r.a.createElement("label",null,r.a.createElement("input",{name:"mapAnns",type:"checkbox",onChange:function(e){S?I(void 0):n?I("screen-"+n):t&&I("project-"+t)}}),"Load Key-Value Pairs"),r.a.createElement("h3",null,"Datasets"),r.a.createElement("label",null,r.a.createElement("input",{name:"datasets",type:"checkbox",onChange:function(e){O(w?void 0:t)}}),"Load Datasets")),r.a.createElement("div",null,r.a.createElement("h3",null,"Map Annotations"))))},ye=function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"OMERO.parade"),r.a.createElement("p",null,"To open a Project, to go ?project=1"),r.a.createElement("p",null,"To open a CSV file annotation, to go ?annotation=2"))};var we=function(){var e=S("project"),t=S("screen"),n=S("annotation"),i=void 0;n&&(i={csvFiles:[n=parseInt(n,10)]});var o=Object(a.useState)(i),l=Object(c.a)(o,2),u=l[0],s=l[1];return r.a.createElement("div",{className:"App"},u?r.a.createElement(ge,{toLoad:u,screen:t}):e||t?r.a.createElement(Ee,{project:e,screen:t,setDataToLoad:s}):r.a.createElement(ye,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(we,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[25,1,2]]]);
//# sourceMappingURL=main.3f315ad2.chunk.js.map