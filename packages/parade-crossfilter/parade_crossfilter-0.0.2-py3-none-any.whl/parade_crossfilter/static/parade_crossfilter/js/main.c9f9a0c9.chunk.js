(window["webpackJsonpparade-crossfilter"]=window["webpackJsonpparade-crossfilter"]||[]).push([[0],{1007:function(e,t){},1531:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(65),i=n.n(o),c=(n(697),n(408)),l=n(54),u=n.n(l),s=n(96),m=n(66),d=n(683),f=n(684),p=n(690),h=n(685),v=n(72),g=n(691),b=n(218);function y(e,t){fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.body.getReader()})).then((function(e){!function(e,t){var n=[];e.read().then((function a(r){var o=r.done,i=r.value;if(o)t(n.join(""));else{for(var c=0;c<i.length;c++)n.push(String.fromCharCode(i[c]));e.read().then(a)}}))}(e,t)}))}function E(e){return w.apply(this,arguments)}function w(){return(w=Object(s.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){return console.log("fetchJson",e),e}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return x.apply(this,arguments)}function x(){return(x=Object(s.a)(u.a.mark((function e(t,n){var a,r,o,i,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.split("-")[1],r=t.split("-")[0],o="project"===r?"images":"wells",i=window.OMEROWEB_INDEX+"parade_crossfilter/annotations/".concat(r,"/").concat(a,"/").concat(o,"/?type=").concat(n),e.next=6,E(i);case 6:return c=e.sent,console.log("fetch anns",c),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return I.apply(this,arguments)}function I(){return(I=Object(s.a)(u.a.mark((function e(t){var n,a,r,o,i,c,l,s,m;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.datasets){e.next=7;break}return a=t.datasets,r=window.OMEROWEB_INDEX+"parade_crossfilter/datasets/".concat(a),e.next=5,E(r);case 5:o=e.sent,n=o.data;case 7:if(i={},!t.mapAnns){e.next=14;break}return c=t.mapAnns,e.next=12,O(c,"map");case 12:l=e.sent,i.maps=l.annotations;case 14:if(!t.tags){e.next=20;break}return s=t.tags,e.next=18,O(s,"tag");case 18:m=e.sent,i.tags=m.annotations;case 20:return e.abrupt("return",{datasetsInfo:n,annData:i});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=n(71),C=n(168);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function _(e,t){t||(t=Object.keys(e[0]));var n=t.map((function(e){var t=e.trim();return"image_id"===t&&(t="Image"),"roi_id"===t&&(t="ROI"),"shape_id"===t&&(t="Shape"),"well_id"===t&&(t="Well"),{name:t,origName:e,type:void 0,empty:!0}})),a=e.map((function(e,t){var a=!0;return n.forEach((function(t){if(e[t.origName]&&0!==e[t.origName].length){a=!1,t.empty=!1;var n=e[t.origName];if("number"===t.type){var r=+n;isNaN(r)||(n=r)}else if(void 0===t.type){var o=+n;isNaN(o)?t.type="string":(t.type="number",n=o)}e[t.name]=n}})),!a&&(e._rowID=t,e)})).filter(Boolean);return{columns:n=n.filter((function(e){return!e.empty})),parsedData:a}}function P(e,t,n){var a=[],r=[];if(e){var o=_(e);a=o.columns,r=o.parsedData}if(n.maps){var i=function(e){var t={};e.forEach((function(e){var n=e.link.parent.id,a=e.link.parent.class.slice(0,-1);t[n]||(t[n]={}),e.values.forEach((function(e){t[n][e[0]]=e[1]})),t[n][a]=n}));var n=Object.keys(t).map((function(e){return D({},t[e])})),a=n.reduce((function(e,t){return Object.keys(t).forEach((function(t){e.add(t)})),e}),new Set);return _(n,Object(S.a)(a.values()))}(n.maps);if(0===r.length)r=i.parsedData,a=i.columns;else{a=a.concat(i.columns.filter((function(e){return"Image"!==e.name})));var c=i.parsedData.reduce((function(e,t){return e[t.Image]=t,e}),{});r=r.map((function(e){return D({},e,{},c[e.Image]||{})}))}}if(n.tags){var l=n.tags.reduce((function(e,t){var n=t.link.parent.id,a=t.textValue;return e[n]||(e[n]=[]),e[n].includes(a)||e[n].push(a),e}),{});0===a.length?(a.push({name:"Image",type:"number"}),r=Object.keys(l).map((function(e){return{Image:e,Tags:l[e]}}))):r=r.map((function(e){return D({},e,{Tags:l[e.Image]||[]})})),a.push({name:"Tags",type:"array"})}if(t){var u={};t.forEach((function(e){u[e.image.id]=e.dataset})),a.push({name:"Dataset",type:"string"}),r=r.map((function(e){return e.Image&&u[e.Image]?D({},e,{Dataset:u[e.Image].name}):e}))}return{columns:a,parsedData:r}}function M(e,t){var n;return void 0!==t&&("number"==typeof(n=t)&&isFinite(n)&&n%1===0)||(t=2),e<1024?e+" B":e<1048576?(e/1024).toFixed(t)+" KB":e<1073741824?(e/1048576).toFixed(t)+" MB":e<1099511627776?(e/1073741824).toFixed(t)+" GB":e<0x4000000000000?(e/1099511627776).toFixed(t)+" TB":(e/0x4000000000000).toFixed(t)+" PB"}function R(e){var t=e.length,n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.reduce((function(e,n){for(var a=Math.floor(n/t);a>e.length;)e.push(0);return e[e.length-1]+=1,e}),[0])}(e).reduce((function(e,t,n){var a=0;return n>1&&(a=e.y[n-1]),e.y.push(t+a),e.x.push(n),e}),{x:[],y:[]});return n.y=n.y.map((function(e){return e/t*100})),n}function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var B=r.a.createContext("CXContext"),W=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={loading:!1,hasNDX:!1,selectedIds:[]},n.setSelectedIds=n.setSelectedIds.bind(Object(v.a)(n)),n}return Object(g.a)(t,e),Object(f.a)(t,[{key:"setSelectedIds",value:function(e){console.log("DataContext.setSelectedIds",e),this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.state,{selectedIds:e}))}},{key:"addGroupBy",value:function(e){var t=this,n=function(e,t,n){var a=Object(C.default)(e.all()).dimension((function(e){return e[n]})).group();a.reduce((function(e,n){return t.forEach((function(t){"number"===t.type?(e[t.name].sum=e[t.name].sum+n[t.name],e[t.name].max=Math.max(n[t.name],e[t.name].max),e[t.name].min=Math.min(n[t.name],e[t.name].min)):void 0===e[t.name].text?e[t.name].text=n[t.name]:e[t.name].text!==n[t.name]&&(e[t.name].text="-")})),e.paradeRowCount=e.paradeRowCount+1,e}),(function(e,n){return t.forEach((function(t){e[t.name].sum=e[t.name].sum-n[t.name]})),e.paradeRowCount=e.paradeRowCount-1,e}),(function(){var e={paradeRowCount:0};return t.forEach((function(t){e[t.name]={sum:0,max:-1/0,min:1/0,text:void 0}})),e}));var r="Rows per "+n,o={},i={},c=a.all().map((function(e,a){var c={_rowID:a};return c[n]=e.key,c[r]=e.value.paradeRowCount,t.forEach((function(t){if("number"===t.type){c[t.name]=e.value[t.name].sum/e.value.paradeRowCount;var n=e.value[t.name].min,a=e.value[t.name].max;c["min ".concat(t.name)]=n,c["max ".concat(t.name)]=a,c["range ".concat(t.name)]=a-n,n!==a&&(o[t.name]=!0)}else c[t.name]=e.value[t.name].text,"-"===c[t.name]&&(i[t.name]=!0)})),c})),l=["Screen","Plate","Well","Project","Dataset","Image","ROI","Shape"].filter((function(e){return o[e]}));t.forEach((function(e){o[e.name]||(l.push("min ".concat(e.name)),l.push("max ".concat(e.name)))})),l=l.concat(Object.keys(i)),c=c.map((function(e){return l.forEach((function(t){delete e[t]})),e})),t=t.filter((function(e){return!l.includes(e.name)}));var u=[];return t.forEach((function(e){u.push(e),o[e.name]&&(u.push({name:"min ".concat(e.name),type:"number"}),u.push({name:"max ".concat(e.name),type:"number"}),u.push({name:"range ".concat(e.name),type:"number"}))})),u.splice(1,0,{name:r,type:"number"}),{columns:u,data:c}}(this.orig_data,this.columns,e);this.orig_data=Object(C.default)(n.data),this.columns=n.columns,this.setState({hasNDX:!1,loading:!0}),setTimeout((function(){t.setState({hasNDX:!0,loading:!1})}),100)}},{key:"initCrossfilter",value:function(e,t,n){var a=P(e,t,n),r=a.columns,o=a.parsedData;this.orig_data=Object(C.default)(o),this.columns=r,this.ndx=this.orig_data,this.setState({loading:!1,hasNDX:!0})}},{key:"loadData",value:function(e){var t=this;this.setState({loading:!0}),function(){var n=Object(s.a)(u.a.mark((function n(){var a,r,o,i;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,j(e);case 2:a=n.sent,r=a.datasetsInfo,o=a.annData,e.csvFiles&&e.csvFiles.length>0?(i=e.csvFiles[0],y(window.OMEROWEB_INDEX+"webclient/annotation/".concat(i),(function(e){t.initCrossfilter(b.csvParse(e),r,o)}))):t.initCrossfilter(void 0,r,o);case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}()()}},{key:"render",value:function(){var e=this;console.log("DataContext.render()",this.state.selectedIds);var t={setDataToLoad:function(t){e.loadData(t)},ndx:void 0,columns:[],addGroupBy:function(t){e.addGroupBy(t)},setSelectedIds:this.setSelectedIds,selectedIds:this.state.selectedIds};return this.state.hasNDX&&(t.ndx=this.orig_data,t.columns=this.columns),r.a.createElement(B.Provider,{value:t},r.a.createElement("div",{ref:this.parent},this.props.children))}}]),t}(r.a.Component),z=function(){return console.log("render Header"),r.a.createElement("span",{className:"navbar-brand col-sm-3 col-md-2 mr-0"},"OMERO.parade")},T=n(10),X=n(282),A=n(173),L=function(e){var t=r.a.useContext(B);console.log("render DimensionChooser - context");return r.a.createElement("select",{value:"--",onChange:function(n){var a=n.target.value,r=t.columns.find((function(e){return e.name===a}));e.addFilter(r)},style:{margin:10,width:"calc(100% - 20px)"}},r.a.createElement("option",{value:"--"},"Add Filter"),t.columns.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))},H=n(79),G=function(e){var t=e.chart,n=e.isFiltered;return r.a.createElement("button",{type:"button",className:"btn btn-light btn-sm",style:{position:"absolute",right:0,opacity:n?1:0},onClick:function(){t.filterAll(),H.redrawAll()}},"reset")},U=function(e){var t=r.a.useContext(B),n=r.a.useState(null),a=Object(T.a)(n,2),o=a[0],i=a[1],c=r.a.useState(!1),l=Object(T.a)(c,2),u=l[0],s=l[1],m=t.ndx,d=r.a.useRef(null),f=e.dimName,p=e.chartFunction,h=e.setSubheading;r.a.useEffect((function(){var e=p(d.current,m,f);return e.render(),e.on("filtered",(function(e,t){if(s(null!=t),t&&"RangedFilter"===t.filterType){var n=t?"".concat(t[0].toFixed(2)," - ").concat(t[1].toFixed(2)):"";h(n)}})),i(e),function(){e.dimension().dispose(),H.redrawAll()}}),[p,f,m,h]);return r.a.createElement("div",{ref:d,style:{width:"100%",height:"auto",boxSizing:"border-box",padding:0,position:"relative"}},r.a.createElement(G,{isFiltered:u,chart:o}))},V=function(e,t,n){var a=t.dimension((function(e){return e[n]})),r=1.01*a.top(1)[0][n],o=a.bottom(1)[0][n],i=(r-o)/20,c=a.group((function(e){return Math.floor(e/i)*i})),l=H.barChart(e);return l.dimension(a).group(c).x(Object(b.scaleLinear)().domain([o,r])).xUnits((function(){return 20})).centerBar(!0).elasticY(!0).xAxis(),l},K=function(e){return r.a.createElement(U,{chartFunction:V,setSubheading:e.setSubheading,dimName:e.dimName})},J=function(e){var t=r.a.useContext(B).ndx,n=r.a.useRef(null),a=e.dimName;r.a.useEffect((function(){var e=function(e,t,n){var a=H.rowChart(e),r=t.dimension((function(e){return e[n]})),o=r.group();return a.dimension(r).group(o),a}(n.current,t,a);return e.render(),function(){e.dimension().dispose(),H.redrawAll()}}),[a,t]);return r.a.createElement("div",{ref:n,style:{width:"100%",height:"auto",boxSizing:"border-box",padding:0,position:"relative"}})},Z=function(e){var t=e.dimName,n=r.a.useContext(B),a=r.a.useState(""),o=Object(T.a)(a,2),i=o[0],c=o[1],l=r.a.useState(null),u=Object(T.a)(l,2),s=u[0],m=u[1],d=n.ndx;r.a.useEffect((function(){var e=d.dimension((function(e){return e[t]}));return m(e),function(){e.dispose(),H.redrawAll()}}),[t,d]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"text",placeholder:"Filter by ".concat(t),className:"form-control",value:i,onChange:function(e){var t=e.target.value;c(t),s.filter((function(e){return e.indexOf(t)>-1})),H.redrawAll()}}),r.a.createElement(J,{dimName:t}))},Y=function(e){var t=e.dimName,n=e.dimType,o=e.removeFilter,i=Object(a.useState)(""),c=Object(T.a)(i,2),l=c[0],u=c[1];return r.a.createElement("div",{className:"toast show",role:"alert","aria-live":"assertive","aria-atomic":"true"},r.a.createElement("div",{className:"toast-header"},r.a.createElement("strong",{className:"mr-auto"},t),r.a.createElement("small",{className:"text-muted"},l),r.a.createElement("button",{type:"button",className:"ml-2 mb-1 close","data-dismiss":"toast","aria-label":"Close",onClick:function(){o(t)}},r.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),r.a.createElement("div",{className:"toast-body"},"number"===n?r.a.createElement(K,{dimName:t,setSubheading:u}):r.a.createElement(Z,{dimName:t})))},$=function(){var e=r.a.useContext(B).ndx,t=r.a.useState([0,0]),n=Object(T.a)(t,2),a=n[0],o=n[1];return r.a.useEffect((function(){if(e)return o([e.allFiltered().length,e.all().length]),e.onChange((function(t){o([e.allFiltered().length,e.all().length])}))}),[e]),r.a.createElement("span",null,"Filtering ",a[0]," / ",a[1])},q=function(){console.log("render Filters");var e=r.a.useState([]),t=Object(T.a)(e,2),n=t[0],a=t[1],o=function(e){a(n.filter((function(t){return t.name!==e})))};return r.a.createElement("div",null,r.a.createElement("h6",{className:"sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1"},r.a.createElement("span",null,"Filters"),r.a.createElement($,null)),r.a.createElement(L,{addFilter:function(e){n.find((function(t){return t.name===e.name}))||a(n.concat(e))}}),r.a.createElement("div",{style:{padding:10}},n.map((function(e){return r.a.createElement(Y,{key:e.name,removeFilter:o,dimType:e.type,dimName:e.name})}))))},Q=function(){var e=r.a.useContext(B),t=e.columns.filter((function(e){return"number"===e.type}));return r.a.createElement("select",{value:"--",onChange:function(t){var n=t.target.value;e.addGroupBy(n)},style:{margin:10,width:"calc(100% - 20px)"}},r.a.createElement("option",{value:"--"},"Add Group-by"),t.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))},ee=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h6",{className:"sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1"},r.a.createElement("span",null,"Group By")),r.a.createElement(Q,null))};n(417),n(418);var te=function(){var e=Object(a.useState)(!0),t=Object(T.a)(e,2),n=t[0],o=t[1],i={zIndex:100,padding:"0",display:"block",flexGrow:0,flexShrink:0,width:n?320:0,transition:"width 0.5s ease-in-out",backgroundColor:"#4f545a",color:"white"},c={transform:n?"rotate(0deg)":"rotate(180deg)"};return r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{style:i},r.a.createElement(ee,null),r.a.createElement(q,null)),r.a.createElement("nav",{style:{zIndex:110,padding:"0",boxShadow:"inset -1px 0 0 rgba(0, 0, 0, .1)",display:"block",flex:"0 0 50px",backgroundColor:"#4f545a"}},r.a.createElement("div",{className:"sidebar-sticky",style:{padding:7}},r.a.createElement("button",{onClick:function(){o(!n)},type:"button",className:"btn btn-light",style:c},r.a.createElement(X.a,{icon:A.a})))))},ne=n(121),ae=n.n(ne),re=n(224);function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ce={cursor:"pointer"},le={width:"calc(100%-10px)",height:"100%",paddingTop:5,margin:2,overflowX:"auto"},ue=ae()({monitorHeight:!0})((function(e){var t=e.sortBy,n=e.setSortBy,a=e.sortReverse,o=e.setSortReverse,i=e.size,c=r.a.useContext(B),l=c.columns.map((function(e){return e.name})),u=r.a.useState([]),s=Object(T.a)(u,2),m=s[0],d=s[1],f=c.ndx,p=c.selectedIds,h=c.setSelectedIds;r.a.useEffect((function(){d(f.allFiltered());var e=f.onChange((function(e){d(f.allFiltered())}));return function(){e()}}),[f]);var v=r.a.useRef(null);if(r.a.useEffect((function(){if(p.length>0){var e=m.map((function(e){return e._rowID})),t=p.map((function(t){return e.indexOf(t)}));v.current.scrollToItem({align:"center",rowIndex:t[0]})}}),[p,t,a,m]),t){var g=a?-1:1;m.sort((function(e,n){var a=void 0===e[t]?"":e[t],r=void 0===n[t]?"":n[t];return a===r?0:a>r?g:-g}))}var b=function(e){return p.indexOf(m[e]._rowID)>-1};return r.a.createElement("div",{style:le},r.a.createElement(re.a,{height:35,columnCount:l.length,columnWidth:100,rowCount:1,rowHeight:35,width:100*l.length+20},(function(e){var i,c=e.columnIndex,u=(e.rowIndex,e.style);return r.a.createElement("div",{style:ie({},u,{},ce),onClick:function(){return t===l[e=c]?o(!a):o(!1),void n(l[e]);var e}},l[c],r.a.createElement(X.a,{icon:(i=l[c],i!==t?A.b:a?A.d:A.c),style:{marginLeft:3}}))})),r.a.createElement(re.a,{ref:v,height:i.height-50,columnCount:l.length,columnWidth:100,rowCount:m.length,rowHeight:35,width:100*l.length+20},(function(e){var t=e.columnIndex,n=e.rowIndex,a=e.style,o=m[n][l[t]],i=o;return"object"===typeof o?i=(o=o.sort()).join(", "):void 0!==o&&o.toPrecision&&!Number.isInteger(o)&&(i=o.toPrecision(4)),r.a.createElement("div",{style:ie({},a,{background:b(n)?"#b1b3f4":"white",padding:5}),onClick:function(){return function(e){if(b(e))h([]);else{var t=m[e]._rowID;h([t])}}(n)},className:"table_cell",title:o},i,"Image"===l[t]&&r.a.createElement("img",{alt:"Thumbnail",src:"".concat(window.OMEROWEB_INDEX,"webclient/render_thumbnail/").concat(m[n][l[t]],"/")}),"Shape"===l[t]&&r.a.createElement("img",{alt:"Shape Thumbnail",src:"".concat(window.OMEROWEB_INDEX,"webgateway/render_shape_thumbnail/").concat(m[n][l[t]],"/?color=ff0")}))})))})),se=n(686),me=n.n(se),de=n(410);function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var he=function(e){var t=e.data,n=e.layout,a=e.config,o=e.onSelected,i=e.style,c=r.a.useState(void 0),l=Object(T.a)(c,2),u=l[0],s=l[1],m=r.a.useState(void 0),d=Object(T.a)(m,2),f=d[0],p=d[1],h=r.a.useState(n.xaxis.title.text),v=Object(T.a)(h,2),g=v[0],b=v[1],y=r.a.useState(n.yaxis.title.text),E=Object(T.a)(y,2),w=E[0],O=E[1];r.a.useEffect((function(){var e=n.xaxis.title.text,t=n.yaxis.title.text;g===e&&w===t||(s(void 0),p(void 0),b(e),O(t))}),[n,g,w]);var x=pe({},n.xaxis,{range:u}),j=pe({},n.yaxis,{range:f}),I=pe({},n,{xaxis:x,yaxis:j});return r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){de.plot("graph",t,n).then((function(e){return de.toImage(e)})).then((function(e){var t=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var r=n[a].trim();if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t}("csrftoken"),n="".concat(window.OMEROWEB_INDEX,"parade_crossfilter/save_image/");fetch(n,{method:"POST",mode:"cors",credentials:"include",body:JSON.stringify({data:e}),headers:{"Content-Type":"application/json","X-CSRFToken":t}}).then((function(e){return console.log(e.json())}))}))}},"Save"),r.a.createElement(me.a,{data:t,config:a,layout:I,onUpdate:function(e,t){s(e.layout.xaxis.range),p(e.layout.yaxis.range)},onSelected:o,useResizeHandler:!0,style:i}),r.a.createElement("div",{id:"graph",style:{display:"none"}}))},ve=function(e){var t=e.height,n=e.xAxis,a=e.yAxis,o=e.groupBy,i=e.cumulativePlot,c=e.selectedIds,l=e.setSelectedIds,u=r.a.useContext(B).ndx,s=r.a.useState([]),m=Object(T.a)(s,2),d=m[0],f=m[1],p=[];if(o){var h={};d.forEach((function(e){var t=e[o];h[t]||(h[t]=[]),h[t].push({x:e[n],y:e[a],id:e._rowID})}));var v=Object.keys(h);v.sort(),p=v.map((function(e){var t=h[e];t.sort((function(e,t){return e.x>t.x?1:e.x<t.x?-1:0}));var n=t.map((function(e){return e.x})),a=t.map((function(e){return e.y}));if(i){var r=R(n);n=r.x,a=r.y}return{x:n,y:a,customdata:t.map((function(e){return e.id})),type:"scattergl",mode:"lines+markers",name:e}}))}else{var g={selected:[]," ":[]};d.forEach((function(e){c.indexOf(e._rowID)>-1?g.selected.push({x:e[n],y:e[a],id:e._rowID}):g[" "].push({x:e[n],y:e[a],id:e._rowID})})),p=[" ","selected"].map((function(e){var t=g[e],n=t.map((function(e){return e.x})),a=t.map((function(e){return e.y}));if(i){n.sort((function(e,t){return e>t?1:e<t?-1:0}));var r=R(n);n=r.x,a=r.y}return{x:n,y:a,customdata:t.map((function(e){return e.id})),type:"scattergl",mode:"markers",name:e,marker:{color:"selected"===e?"red":"rgb(31, 119, 180)"}}}))}return r.a.useEffect((function(){f(u.allFiltered());var e=u.onChange((function(e){f(u.allFiltered())}));return function(){e()}}),[n,a,o,u]),0===p.length?r.a.createElement("div",null,"No data"):r.a.createElement(he,{style:{width:"100%",height:t},data:p,config:{responsive:!0,displayModeBar:!0},layout:{autosize:!0,showlegend:Boolean(o),margin:{l:60,r:10,b:40,t:40,pad:4},xaxis:{title:{text:n,font:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}},yaxis:{title:{text:i?"cumulative %":a,font:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}}},onSelected:function(e){if(e&&e.points){var t=e.points.map((function(e){return e.customdata}));l(t)}}})},ge={marginLeft:10,marginRight:5},be=function(e){var t=e.label,n=e.options,a=e.value,o=e.handleSelectChange;return r.a.createElement(r.a.Fragment,null,r.a.createElement("label",{style:ge},t,": "),r.a.createElement("select",{onChange:function(e){o(e.target.value)},value:a},n.map((function(e){return r.a.createElement("option",{value:e,key:e},e)}))))},ye={marginLeft:10,marginRight:5},Ee=ae()({monitorHeight:!0})((function(e){var t=e.size,n=e.cumulativePlot,a=r.a.useContext(B),o=a.selectedIds,i=a.setSelectedIds,c=a.columns.filter((function(e){return"number"===e.type}));console.log("render PlotContainer - context");var l,u,s=r.a.useState(c[0]),m=Object(T.a)(s,2),d=m[0],f=m[1],p=c.map((function(e){return e.name}));c.length>1&&(u=c.map((function(e){return e.name})),l=c[1]);var h=r.a.useState(l),v=Object(T.a)(h,2),g=v[0],b=v[1],y=r.a.useState(void 0),E=Object(T.a)(y,2),w=E[0],O=E[1];if(!l)return r.a.createElement("div",null,'"Need at least 2 number columns for Scatter Plot"');return r.a.createElement("div",{style:{height:"100%"}},r.a.createElement("div",{style:{paddingTop:5,position:"absolute",zIndex:10,fontSize:"90%"}},!n&&r.a.createElement(be,{label:"Y",options:p,value:d.name,handleSelectChange:function(e){var t=a.columns.find((function(t){return t.name===e}));f(t),i([])}}),r.a.createElement(be,{label:"X",options:u,value:g.name,handleSelectChange:function(e){var t=a.columns.find((function(t){return t.name===e}));b(t),i([])}}),r.a.createElement("label",{style:ye},"Group by:"),r.a.createElement("select",{onChange:function(e){var t=e.target.value;"-"===t&&(t=void 0),O(t)}},r.a.createElement("option",{value:"-"},"-"),a.columns.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))),r.a.createElement("div",{style:{width:"calc(100% - 10px)",position:"absolute",top:49,zIndex:1},className:"draggableCancel"},r.a.createElement(ve,{height:t.height-60,xAxis:g.name,yAxis:d.name,groupBy:w,cumulativePlot:n,selectedIds:o,setSelectedIds:i})))})),we=function(e){var t=e.height,n=e.xAxis,a=e.yAxis,o=r.a.useContext(B).ndx,i=r.a.useState([]),c=Object(T.a)(i,2),l=c[0],u=c[1];return r.a.useEffect((function(){var e=function(e){var t={};e.forEach((function(e){var r=e[n];t[r]||(t[r]=[]),t[r].push(e[a])}));var r=Object.keys(t);r.sort();var o=r.map((function(e){return{y:t[e],type:"box",name:e}}));u(o)};e(o.allFiltered());var t=o.onChange((function(t){e(o.allFiltered())}));return function(){t()}}),[n,a,o]),0===l.length?r.a.createElement("div",null,"No data"):r.a.createElement(he,{style:{width:"100%",height:t},config:{responsive:!0,displayModeBar:!0},data:l,layout:{autosize:!0,showlegend:!1,xaxis:{title:{}},yaxis:{title:{text:a,font:{family:"Courier New, monospace",size:18,color:"#7f7f7f"}}}}})},Oe={marginLeft:10,marginRight:5},xe=ae()({monitorHeight:!0})((function(e){var t=e.size,n=(e.selectedIds,e.setSelectedIds),a=r.a.useContext(B),o=a.columns.filter((function(e){return"number"===e.type})),i=a.columns.filter((function(e){return"number"!==e.type})),c=r.a.useState(o[0]),l=Object(T.a)(c,2),u=l[0],s=l[1],m=r.a.useState(i[0]),d=Object(T.a)(m,2),f=d[0],p=d[1];if(0===o.length)return r.a.createElement("div",null,"No number columns: plot not available");return r.a.createElement("div",{style:{height:"100%"}},r.a.createElement("div",{style:{paddingTop:5,position:"absolute",zIndex:10,fontSize:"90%"}},r.a.createElement("label",{style:Oe},"Y: "),r.a.createElement("select",{onChange:function(e){var t=e.target.value,r=a.columns.find((function(e){return e.name===t}));s(r),n([])},value:u.name},o.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)}))),r.a.createElement("label",{style:Oe},"X: "),r.a.createElement("select",{onChange:function(e){var t=e.target.value,r=a.columns.find((function(e){return e.name===t}));p(r),n([])},value:f.name},i.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)})))),r.a.createElement("div",{style:{width:"calc(100% - 10px)",position:"absolute",top:49,zIndex:1},className:"draggableCancel"},r.a.createElement(we,{height:t.height-60,xAxis:f.name,yAxis:u.name,setSelectedIds:n})))})),je=function(e){var t=e.wellSample,n=e.rows,a=e.heatmap,o=e.heatmapMin,i=e.heatmapMax,c=e.setSelectedIds,l=(t.Image["@id"],{opacity:n&&n.length>0?1:.1,width:15,height:15,float:"left",margin:1}),u=function(){c(n.map((function(e){return e._rowID})))},s=function(e){if(0===e.length||"--"===a)return"";var t=e.map((function(e){return e[a]})).filter((function(e){return!isNaN(e)}));return t.reduce((function(e,t){return e+t}),0)/t.length}(n),m="".concat(s," (").concat(n.length," rows)");return l.background=function(e){if(""===e||void 0===e)return"rgba(0,0,0,1)";var t=(e-o)/(i-o),n=0,a=0;return t>.5&&(n=parseInt(256*(t-.5)*2)),t<.5&&(a=parseInt(2*(.5-t)*256)),"rgba("+[n,a,0,1].join(",")+")"}(s),r.a.createElement("div",{onClick:u,title:m,style:l})},Ie=function(e){var t=e.well,n=e.showFields,a=e.rows,o=e.heatmap,i=e.heatmapMin,c=e.heatmapMax,l=e.setSelectedIds;if(n){var u={};if(a)for(var s=0;s<a.length;s++){var m=a[s];u[m.Image]||(u[m.Image]=[]),u[m.Image].push(m)}return r.a.createElement(r.a.Fragment,null,t.WellSamples.map((function(e){return r.a.createElement(je,{key:e.Image["@id"],wellSample:e,rows:u[e.Image["@id"]]||[],heatmap:o,heatmapMin:i,heatmapMax:c,setSelectedIds:l})})))}return r.a.createElement(je,{wellSample:t.WellSamples[0],rows:a,heatmap:o,heatmapMin:i,heatmapMax:c,setSelectedIds:l})},Se=function(e){var t=e.plate,n=e.showFields,o=e.heatmap,i=e.selectedIds,c=e.setSelectedIds,l=Object(a.useState)([]),u=Object(T.a)(l,2),s=u[0],m=u[1],d=r.a.useState([]),f=Object(T.a)(d,2),p=f[0],h=f[1],v=r.a.useContext(B).ndx;r.a.useEffect((function(){h(v.allFiltered());var e=v.onChange((function(e){h(v.allFiltered())}));return function(){e()}}),[v]),Object(a.useEffect)((function(){var e=window.OMEROWEB_INDEX+"api/v0/m/plates/".concat(t.id,"/wells/");fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){m(e.data)}))}),[t]);var g={},b=-1,y=-1;s.forEach((function(e){var t=e.Row,n=e.Column;b=Math.max(b,t),y=Math.max(y,n),g[t]||(g[t]={}),g[t][n]=e}));for(var E={},w=0;w<p.length;w++){var O=p[w],x=O.Well;x&&(E[x]||(E[x]=[]),E[x].push(O))}for(var j=[],I=0;I<=b;I++){for(var S=[],C=0;C<=y;C++)g[I]&&g[I][C]?S.push(g[I][C]):S.push({"@id":I});j.push(S)}var k,D,N=function(e){var t=E[e];if(!t)return!1;var n=t.map((function(e){return e._rowID})),a=i.reduce((function(e,t){return e||n.indexOf(t)>-1}),!1);return a};if("--"!==o){var _=v.dimension((function(e){return e[o]}));_.bottom(1).length>0&&(k=_.bottom(1)[0][o],D=_.top(1)[0][o])}return r.a.createElement("div",null,r.a.createElement("div",null,t.Name," (",s.length," Wells) "),r.a.createElement("table",{className:"plateGrid"},r.a.createElement("tbody",null,j.map((function(e){return r.a.createElement("tr",{key:e[0]["@id"]},e.map((function(e){return r.a.createElement("td",{key:e["@id"],style:{background:N(e["@id"])?"rgb(177, 179, 244)":""}},r.a.createElement(Ie,{well:e,showFields:n,heatmap:o,heatmapMin:k,heatmapMax:D,rows:E[e["@id"]]||[],selectedIds:i,setSelectedIds:c}))})))})))))},Ce=function(e){var t=e.setShowFields,n=e.heatmap,a=e.setHeatmap,o=r.a.useContext(B),i=o.ndx,c=o.columns.filter((function(e){return"number"===e.type})),l="";if("--"!==n){var u=i.dimension((function(e){return e[n]}));u.bottom(1).length>0&&(l=parseInt(u.bottom(1)[0][n])+" - "+parseInt(u.top(1)[0][n]))}return r.a.createElement("div",{style:{position:"absolute",width:350,top:0,right:0}},r.a.createElement("label",null,"Fields:",r.a.createElement("input",{type:"checkbox",onChange:function(e){t(e.target.checked)}}),"Heatmap:",r.a.createElement("select",{value:n,onChange:function(e){a(e.target.value)},style:{margin:5}},r.a.createElement("option",{value:"--"},"Heatmap"),c.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.name)}))),l))},ke=function(e){var t=e.screenId,n=e.selectedIds,o=e.setSelectedIds,i=Object(a.useState)([]),c=Object(T.a)(i,2),l=c[0],u=c[1],s=Object(a.useState)(!1),m=Object(T.a)(s,2),d=m[0],f=m[1],p=r.a.useState("--"),h=Object(T.a)(p,2),v=h[0],g=h[1];return Object(a.useEffect)((function(){var e=window.OMEROWEB_INDEX+"api/v0/m/screens/".concat(t,"/plates/");fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){var t=e.data.map((function(e){return{id:e["@id"],Name:e.Name}}));u(t)}))}),[t]),r.a.createElement("div",{style:{position:"relative"}},r.a.createElement(Ce,{setShowFields:f,heatmap:v,setHeatmap:g}),0===l.length?"Loading plates...":"".concat(l.length," plates:"),l.map((function(e){return r.a.createElement(Se,{key:e.id,plate:e,showFields:d,heatmap:v,selectedIds:n,setSelectedIds:o})})))},De=function(e){var t=e.imgData,n=e.size,a=e.x,o=e.y,i=t.id,c=t.size.width/t.size.height,l=192,u=192;return c>1?u=192/c:l=192*c,r.a.createElement("div",{style:{width:l,height:u,position:"relative",display:"inline-block"}},r.a.createElement("img",{style:{width:l,height:u,position:"absolute",top:0,left:0},src:window.OMEROWEB_INDEX+"webclient/render_thumbnail/".concat(i),alt:"Bird's eye view"}),r.a.createElement("div",{style:{position:"absolute",border:"solid yellow 1px",left:l*a/t.size.width,top:u*o/t.size.height,width:n*l/t.size.width,height:n*u/t.size.height}}))},Ne=function(e){var t=e.imgData,n=e.roiData,a=e.rowData,o=t.id,i=r.a.useState(400),c=Object(T.a)(i,2),l=c[0],u=c[1],s=r.a.useState({x:0,y:0}),m=Object(T.a)(s,2),d=m[0],f=m[1];r.a.useEffect((function(){var e;if(t.tiles)if(n){var a=function(e){if(e.shapes[0]&&e.shapes[0].Points){var t=e.shapes[0].Points.split(" ").map((function(e){return e.split(",")})),n=t.map((function(e){return parseFloat(e[0])})),a=t.map((function(e){return parseFloat(e[1])})),r=n.reduce((function(e,t){return Math.min(e,t)})),o=n.reduce((function(e,t){return Math.max(e,t)})),i=a.reduce((function(e,t){return Math.min(e,t)}));return{x:r,y:i,width:o-r,height:a.reduce((function(e,t){return Math.max(e,t)}))-i}}}(n);e=Math.max(a.width,a.height),e=Math.max(3*e,l);var r=a.x+a.width/2,o=a.y+a.height/2;u(e),f({x:r,y:o})}else e=Math.max(t.size.width,t.size.height),u(e),f({x:t.size.width/2,y:t.size.height/2})}),[t,n,l]);var p,h,v,g,b=function(e){"+"===e.target.value?u(l/2):u(2*l)};return t.tiles?(h=l,v=d.x-h/2,g=d.y-h/2,p=window.OMEROWEB_INDEX+"figure/render_scaled_region/".concat(o,"/0/0/?region=").concat(v,",").concat(g,",").concat(h,",").concat(h)):p=Number.isInteger(a.Shape)?window.OMEROWEB_INDEX+"webgateway/render_shape_thumbnail/".concat(a.Shape,"/?color=ff0"):window.OMEROWEB_INDEX+"webclient/render_image/".concat(o,"/"),r.a.createElement("div",null,r.a.createElement("img",{style:{width:350,float:"left"},alt:"Full rendered plane",src:p}),t.tiles&&r.a.createElement("span",null,r.a.createElement("button",{value:"-",onClick:b},"-"),r.a.createElement("button",{value:"+",onClick:b},"+"),r.a.createElement("br",null),r.a.createElement(De,{imgData:t,size:h,x:v,y:g})))},_e=function(e){var t=e.rowData,n=r.a.useState(void 0),a=Object(T.a)(n,2),o=a[0],i=a[1],c=r.a.useState(void 0),l=Object(T.a)(c,2),m=l[0],d=l[1],f=r.a.useState(void 0),p=Object(T.a)(f,2),h=p[0],v=p[1];return r.a.useEffect((function(){function e(){return(e=Object(s.a)(u.a.mark((function e(){var n,a,r,o,c,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Number.isInteger(t.ROI)){e.next=6;break}return n=window.OMEROWEB_INDEX+"api/v0/m/rois/".concat(t.ROI,"/"),e.next=4,E(n);case 4:a=e.sent,d(a.data);case 6:if(!Number.isInteger(t.Image)){e.next=14;break}return r=window.OMEROWEB_INDEX+"webclient/imgData/".concat(t.Image,"/"),e.next=10,E(r);case 10:o=e.sent,i(o),e.next=20;break;case 14:if(!Number.isInteger(t.Well)){e.next=20;break}return c=window.OMEROWEB_INDEX+"api/v0/m/wells/".concat(t.Well,"/"),e.next=18,E(c);case 18:l=e.sent,v(l);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}i(void 0),function(){e.apply(this,arguments)}()}),[t]),r.a.createElement("div",null,o?r.a.createElement("div",null,r.a.createElement("p",null,o.meta.imageName),r.a.createElement(Ne,{imgData:o,roiData:m,rowData:t})):h?r.a.createElement("div",null,h.data.WellSamples.map((function(e){return r.a.createElement("img",{src:window.OMEROWEB_INDEX+"webclient/render_image/".concat(e.Image["@id"],"/0/0/"),style:{maxWidth:250,margin:5},alt:""})}))):r.a.createElement("div",null,"Loading..."))},Pe=n(411),Me=n.n(Pe);function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Be={position:"absolute"},We=function(e){var t=e.rowData,n=r.a.useState(void 0),a=Object(T.a)(n,2),o=a[0],i=a[1],c=r.a.useState(0),l=Object(T.a)(c,2),m=l[0],d=l[1],f=r.a.useState(0),p=Object(T.a)(f,2),h=p[0],v=p[1],g=r.a.useState(0),b=Object(T.a)(g,2),y=b[0],w=b[1],O=r.a.useState(0),x=Object(T.a)(O,2),j=x[0],I=x[1],C=r.a.useState(0),k=Object(T.a)(C,2),D=k[0],N=k[1],_=r.a.useState(0),P=Object(T.a)(_,2),M=P[0],R=P[1];function F(e){var n=e.shapes.map((function(e){return e.TheT})).filter((function(e){return Number.isInteger(e)})),a=e.shapes.map((function(e){return e.TheZ})).filter((function(e){return Number.isInteger(e)}));d(n.length>0?Math.min.apply(Math,Object(S.a)(n)):void 0),v(n.length>0?Math.max.apply(Math,Object(S.a)(n)):void 0),w(Number.isInteger(t.t)?t.t:Math.min.apply(Math,Object(S.a)(n))),I(a.length>0?Math.min.apply(Math,Object(S.a)(a)):void 0),N(a.length>0?Math.max.apply(Math,Object(S.a)(a)):void 0),R(Number.isInteger(t.z)?t.z:Math.min.apply(Math,Object(S.a)(a))),i(e.shapes)}function B(e,t,n){return!o||1===o.length||(void 0===e.TheT||e.TheT===n)&&(void 0===e.TheZ||e.TheZ===t)}return r.a.useEffect((function(){function e(){return(e=Object(s.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i(void 0),!Number.isInteger(t.ROI)){e.next=7;break}return n=window.OMEROWEB_INDEX+"api/v0/m/rois/".concat(t.ROI,"/"),e.next=5,E(n);case 5:F(e.sent.data);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]),r.a.createElement("div",null,r.a.createElement("p",null,"ROI: ",t.ROI," "),o?r.a.createElement("div",{style:{padding:10}},r.a.createElement("div",{style:{position:"relative",height:200}},o.map((function(e){return r.a.createElement("img",{style:Fe({},Be,{visibility:B(e,M,y)?"visible":"hidden"}),key:e["@id"],alt:"Shape ID:".concat(e["@id"]),src:"".concat(window.OMEROWEB_INDEX,"webgateway/render_shape_thumbnail/").concat(e["@id"],"/?color=ff0")})}))),j!==D&&r.a.createElement("div",{className:"draggableCancel"},r.a.createElement(Me.a,{formatLabel:function(e){return"Z: ".concat(e)},maxValue:D,minValue:j,value:M,onChange:function(e){return R(e)}})),m!==h&&r.a.createElement("div",{className:"draggableCancel"},r.a.createElement(Me.a,{formatLabel:function(e){return"T: ".concat(e)},maxValue:h,minValue:m,value:y,onChange:function(e){return w(e)}}))):r.a.createElement("div",null,"Loading..."))};function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xe={padding:2,width:"100%",maxWidth:"100%",maxHeight:"100%"},Ae=ae()({monitorHeight:!0})((function(e){var t=e.sortBy,n=e.sortReverse,a=e.size,o=r.a.useContext(B),i=r.a.useState([]),c=Object(T.a)(i,2),l=c[0],u=c[1],s=o.selectedIds,m=o.setSelectedIds,d=o.ndx,f=o.columns,p=192;console.log("render Images - context"),r.a.useEffect((function(){u(d.allFiltered());var e=d.onChange((function(e){u(d.allFiltered())}));return function(){e()}}),[d]);var h=l;if(s.length>0&&(h=l.filter((function(e){return s.indexOf(e._rowID)>-1}))),t){var v=n?-1:1;h.sort((function(e,n){return e[t]>n[t]?v:-v}))}var g=function(e){return e.Shape?"".concat(window.OMEROWEB_INDEX,"webgateway/render_shape_thumbnail/").concat(e.Shape,"/?color=ff0"):e.Image?"".concat(window.OMEROWEB_INDEX,"webclient/render_thumbnail/").concat(e.Image,"/"):""},b=function(e){return f.map((function(e){return e.name})).filter((function(t){return(""+e[t]).length>0})).map((function(t){return"".concat(t,": ").concat(e[t])})).join("   ")};if(1===s.length){var y=s[0],E=h.filter((function(e){return e._rowID===y}));if(1===E.length)return E[0].ROI&&Number.isInteger(E[0].ROI)?r.a.createElement(We,{rowData:E[0]}):r.a.createElement(_e,{rowData:E[0]})}var w=a.width,O=parseInt(Math.round(w/p)),x=(p=w/O)/(250/166);return r.a.createElement("div",{style:{width:"100%",height:"100%"}},r.a.createElement("h6",{className:"text-muted px-3",style:{paddingTop:"0.7rem"}},h.length,s.length>0?" selected":" rows"),r.a.createElement("div",{style:{width:"100%",position:"absolute",top:40}},r.a.createElement(re.a,{height:a.height-40,columnCount:O,columnWidth:p,rowCount:Math.ceil(h.length/O),rowHeight:x,width:w},(function(e){var t=e.columnIndex,n=e.rowIndex,a=e.style,o=h[n*O+t];return o?r.a.createElement("div",{style:Te({},a)},r.a.createElement("img",{title:b(o),onClick:function(){return m([o._rowID])},alt:"",style:Xe,src:g(o)})):r.a.createElement("span",null)}))))})),Le=n(688),He=n(689),Ge=n(60),Ue=n(412),Ve=n.n(Ue);function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Je=Object(Ue.WidthProvider)(Ve.a);var Ze=function(e){var t=e.screen,n={border:"solid rgb(240, 240, 240) 1px",background:"white",borderRadius:"6px",padding:15},a={position:"absolute",right:3,top:0,cursor:"pointer"},o=r.a.useState(void 0),i=Object(T.a)(o,2),c=i[0],l=i[1],u=r.a.useState(!1),s=Object(T.a)(u,2),d=s[0],f=s[1],p=r.a.useState([{i:"p1",type:"scatter_plot",x:0,y:0,w:8,h:8},{i:"p2",type:"images",x:10,y:0,w:4,h:8},{i:"p3",type:"table",x:0,y:7,w:12,h:8}]),h=Object(T.a)(p,2),v=h[0],g=h[1];function b(e){var t=e.i;return r.a.createElement("div",{key:t,"data-grid":e,style:n},x[e.type],r.a.createElement("span",{className:"remove",style:a,onClick:function(){!function(e){g(v.filter((function(t){return t.i!==e})))}(t)}},"X"))}function y(e){var t=v.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(n,!0).forEach((function(t){Object(m.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{y:e.y+6})})),n=t.reduce((function(e,t){return Math.max(e,parseInt(t.i.replace("p","")))}),0);g([{i:"p"+(n+1),type:e,x:0,y:0,w:8,h:6}].concat(Object(S.a)(t)))}var E=r.a.createElement(ke,{screenId:t}),w=r.a.createElement(Ee,null),O=r.a.createElement(Ee,{cumulativePlot:!0}),x={scatter_plot:w,images:r.a.createElement(Ae,{sortBy:c,sortReverse:d}),table:r.a.createElement(ue,{sortBy:c,setSortBy:l,sortReverse:d,setSortReverse:f}),screen:E,box_whisker:r.a.createElement(xe,null),cumulative:O};return r.a.createElement("div",{style:{display:"flex",flexWrap:"nowrap",position:"absolute",top:48,height:"calc(100% - 48px)",bottom:0,width:"100%"}},r.a.createElement(te,null),r.a.createElement("main",{className:"column",style:{flex:"1 1 auto",paddingLeft:15,paddingRight:15,display:"flex",flexDirection:"column",width:"200",overflow:"auto",background:"rgb(240, 240, 240)",position:"relative"}},r.a.createElement("div",{style:{position:"absolute",zIndex:10,width:40,left:5,top:5}},r.a.createElement(Le.a,{style:{borderRadius:20},as:He.a,id:"add-panel-dropdown-button",variant:"primary",title:"+"},r.a.createElement(Ge.a.Item,{eventKey:"1",onClick:function(){y("scatter_plot")}},"Scatter Plot"),r.a.createElement(Ge.a.Item,{eventKey:"3",onClick:function(){y("cumulative")}},"Cumulative percent"),r.a.createElement(Ge.a.Item,{eventKey:"4",onClick:function(){y("box_whisker")}},"Box and Whisker"),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Ge.a.Divider,null),r.a.createElement(Ge.a.Item,{eventKey:"5",onClick:function(){y("screen")}},"Plate Layout")))),r.a.createElement(Je,{draggableCancel:".draggableCancel",className:"layout",cols:12,rowHeight:45},v.map((function(e){return b(e)})))))},Ye=n(175),$e=n(108),qe=n(223);var Qe=function(e){var t=e.project,n=e.screen,o=e.setDataToLoad,i=r.a.useState(!0),c=Object(T.a)(i,2),l=c[0],u=c[1],s=function(){return u(!1)},m=Object(a.useState)(!1),d=Object(T.a)(m,2),f=d[0],p=d[1],h=Object(a.useState)([]),v=Object(T.a)(h,2),g=v[0],b=v[1],y=Object(a.useState)(void 0),E=Object(T.a)(y,2),w=E[0],O=E[1],x=Object(a.useState)(void 0),j=Object(T.a)(x,2),I=j[0],S=j[1],C=Object(a.useState)(void 0),k=Object(T.a)(C,2),D=k[0],N=k[1],_=Object(a.useState)(void 0),P=Object(T.a)(_,2),R=P[0],F=P[1];Object(a.useEffect)((function(){p(!0);var e=window.OMEROWEB_INDEX+"webclient/api/annotations/?type=file";t?e+="&project=".concat(t):n&&(e+="&screen=".concat(n)),fetch(e,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(e){p(!1);var t=e.annotations.filter((function(e){return e.file&&e.file.name.endsWith(".csv")}));b(t)}))}),[t,n]);var B=r.a.createElement("p",null,"Need ?project=id or ?screen=?id to load data");return r.a.createElement(Ye.a,{show:l,onHide:s},r.a.createElement(Ye.a.Header,{closeButton:!0},r.a.createElement(Ye.a.Title,null,"Choose Data")),r.a.createElement(Ye.a.Body,null,t||n?r.a.createElement($e.a,null,r.a.createElement("p",{value:""},f?"Loading...":"Choose a CSV file linked to ".concat(t?"Project":"Screen",":")),r.a.createElement($e.a.Control,{as:"select",multiple:!0,onChange:function(e){var t=parseInt(e.target.value);w===t&&(t=void 0),O(t)}},g.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},"".concat(e.id,": ").concat(e.file.name," (").concat(M(e.file.size),")"))}))),r.a.createElement($e.a.Group,{controlId:"mapAnnsCheckbox"},r.a.createElement($e.a.Check,{type:"checkbox",name:"mapAnns",onChange:function(e){D?N(void 0):n?N("screen-"+n):t&&N("project-"+t)},label:"Load Key-Value Pairs"})),r.a.createElement($e.a.Group,{controlId:"datasetsCheckbox"},r.a.createElement($e.a.Check,{type:"checkbox",name:"datasets",onChange:function(e){S(I?void 0:t)},label:"Load Datasets"})),r.a.createElement($e.a.Group,{controlId:"tagsCheckbox"},r.a.createElement($e.a.Check,{type:"checkbox",name:"tags",onChange:function(e){R?S(void 0):n?F("screen-"+n):t&&F("project-"+t)},label:"Load Tags"}))):B),r.a.createElement(Ye.a.Footer,null,r.a.createElement(qe.a,{variant:"secondary",onClick:s},"Close"),r.a.createElement(qe.a,{variant:"primary",onClick:function(e){e.preventDefault();var t={};w&&(t.csvFiles=[w]),t.datasets=I,t.mapAnns=D,t.tags=R,o(t),u(!1)}},"Load Data")))},et=function(){var e=r.a.useContext(B);console.log("render Main - context");var t=N("project"),n=N("screen");return r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe,{screen:n,project:t,setDataToLoad:e.setDataToLoad}),e.ndx?r.a.createElement(Ze,{screen:n}):r.a.createElement("div",null,"Welcome to OMERO.parade"))},tt=n(217),nt=n(219);window.OME||(window.OME={});var at=function(e,t){var n=e.map((function(e){return{id:e,type:t}}));console.log("selectedObjs",n);var a=n[0].id;return window.OME.open_with_options.map((function(e){console.log("v",e);var t=!1;if("function"===typeof e.isEnabled?t=e.isEnabled(n):"object"===typeof e.supported_objects&&e.supported_objects.length>0&&(t=e.supported_objects.reduce((function(e,t){return e||"images"===t||"image"===t}),!1)),t&&0!==e.url.indexOf("iviewer_url")&&0!=e.url.indexOf("webgateway_url")){var r,o=e.label||e.id;try{r=e.getUrl(n,e.url)}catch(i){}return{text:o,url:r||e.url+"?image="+a}}})).filter((function(e){return e}))};window.OME.open_with_options=[],window.OME.setOpenWithEnabledHandler=function(e,t){console.log("setOpenWithEnabledHandler...",e,t),window.OME.open_with_options.forEach((function(n){n.label===e&&(n.isEnabled=function(){var n=Array.from(arguments),a=!1;try{a=t.apply(this,n)}catch(r){console.log("Open with "+e+": "+r)}return a})}))},window.OME.setOpenWithUrlProvider=function(e,t){console.log("setOpenWithUrlProvider",e),window.OME.open_with_options.forEach((function(n){n.id===e&&(console.log("setting getUrl"),n.getUrl=t)}))};var rt=function(){var e=this,t=r.a.useContext(B),n=t.selectedIds,a=t.ndx;if(r.a.useEffect((function(){var t=window.OMEROWEB_INDEX+"webgateway/open_with/";fetch(t,{mode:"cors",credentials:"include"}).then((function(e){return e.json()})).then((function(t){console.log("open_with",t,e),window.OME.open_with_options=t.open_with_options,window.OME.open_with_options.forEach((function(e){e.script_url&&function(e){"/"===e[0]&&(e=e.slice(1)),e=window.OMEROWEB_INDEX+e;var t=document.createElement("script");t.src=e,console.log("scriptUrl",e,t),document.body.appendChild(t)}(e.script_url)}))}))}),[]),void 0==a)return r.a.createElement("span",null,"...");var o=a.all().filter((function(e){return n.includes(e._rowID)}));function i(e){var t=o.filter((function(t){return t[e]})).map((function(t){return t[e]}));return Object(S.a)(new Set(t))}i("Dataset");var c=i("Image");i("ROI"),i("Shape"),console.log("imageIDs",c);var l=c.length>0?at(c,"image"):[];return console.log("urls",l),r.a.createElement(Ge.a,{as:tt.a,className:"ml-auto navbar-nav pr-md-4"},r.a.createElement(Ge.a.Toggle,{as:nt.a},"Open ",n.length," with..."),r.a.createElement(Ge.a.Menu,null,l.map((function(e){return r.a.createElement(Ge.a.Item,{key:e.text,target:"_blank",href:e.url},e.text)}))))};n(1528),n(1529),n(1530);var ot=function(){var e=N("annotation");return e&&(e=parseInt(e,10)),r.a.createElement("div",{className:"App"},r.a.createElement(W,null,r.a.createElement(c.a,{className:"navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow"},r.a.createElement(z,null),r.a.createElement(rt,null)),r.a.createElement(et,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(ot,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},418:function(e,t,n){},692:function(e,t,n){e.exports=n(1531)},697:function(e,t,n){}},[[692,1,2]]]);
//# sourceMappingURL=main.c9f9a0c9.chunk.js.map