(this["webpackJsonpstreamlit-fesion"]=this["webpackJsonpstreamlit-fesion"]||[]).push([[0],{69:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(47),c=n.n(i),o=n(94),u=n(49),s=n(93),l=n(28),d=n(6),f=function(e){var t=Object(l.useRenderData)().theme;if(null==t)return Object(d.jsx)(d.Fragment,{children:"props.children"});var n=Object(u.a)({palette:{primary:{main:t.primaryColor},background:{default:t.backgroundColor,paper:t.secondaryBackgroundColor},text:{primary:t.textColor}},typography:{fontFamily:t.font}});return Object(d.jsx)(s.a,{theme:n,children:e.children})},p=n(7),h=r.a.createContext(void 0),g=function(e){var t=Object(a.useState)(),n=Object(p.a)(t,2),r=n[0],i=n[1];Object(a.useEffect)((function(){loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"}).then(i)}),[]);var c=Object(a.useMemo)((function(){return{pyodide:r}}),[r]);return Object(d.jsx)(h.Provider,{value:c,children:e.children})},m=n(0),b=n.n(m),j=n(3),v=n(90),O=n(95),y=n(92);function x(e){e.getTracks().forEach((function(e){e.stop()}))}var w=n(25),k=function(e){var t=Object(a.useRef)(null),n=e.imageData;return Object(a.useEffect)((function(){if(null!=t.current){var e=t.current;return e.width=n.width,e.height=n.height,w.Streamlit.setFrameHeight(),function(){w.Streamlit.setFrameHeight()}}}),[n.width,n.height]),Object(a.useEffect)((function(){if(null!=t.current){var e=t.current.getContext("2d");null===e||void 0===e||e.putImageData(n,0,0)}}),[n]),Object(d.jsx)("canvas",{ref:t})};function _(e){return w.Streamlit.setComponentValue(e)}var I="gai6sa2eM9Atiev5Shu5ohtie6phai8i",C=function(){var e=Object(l.useRenderData)(),t=e.args.func_def_code,n=e.args.func_name,r=e.args.dep_packages,i=JSON.stringify(r),c=Object(a.useState)(),o=Object(p.a)(c,2),u=o[0],s=o[1],f=function(){var e=Object(a.useContext)(h);if(null==e)throw new Error("usePyodide() must be used inside <PyodideProvider />.");return e.pyodide}();Object(a.useEffect)((function(){if(_({pythonError:null}),null!=f){var e=JSON.parse(i);Object(j.a)(b.a.mark((function a(){var r;return b.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,f.loadPackage(["numpy"]).then((function(){return f.runPythonAsync("import numpy as ".concat(I))}));case 2:return a.next=4,f.loadPackagesFromImports(t);case 4:if(!e){a.next=7;break}return a.next=7,f.loadPackage(e);case 7:return a.next=9,f.runPythonAsync(t);case 9:r=function(){var e=Object(j.a)(b.a.mark((function e(t){var a,r,i,c,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return self.fesionImageWidth=t.width,self.fesionImageHeight=t.height,self.fesionImageData=t.data,e.prev=3,e.next=6,f.runPythonAsync("\n          from js import fesionImageWidth, fesionImageHeight, fesionImageData  # Import from JS globals\n\n          input_image4chan = ".concat(I,".asarray(fesionImageData.to_py()).reshape((fesionImageHeight, fesionImageWidth, 4)) # 4 channels (RGBA)\n          input_image = input_image4chan[:,:,:3]\n\n          output_image = ").concat(n,"(input_image)\n\n          if ").concat(I,".issubdtype(output_image.dtype, ").concat(I,".floating):\n              output_image = (output_image * 255).astype(").concat(I,".uint8)\n\n          output_alpha = ").concat(I,".full((fesionImageHeight, fesionImageWidth, 1), fill_value=255, dtype=").concat(I,".uint8)\n          output_image4chan = ").concat(I,".concatenate((output_image, output_alpha), axis=2).copy()\n\n          output_height, output_width = output_image4chan.shape[:2]\n          "));case 6:e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(3),"PythonError"===e.t0.name&&_({pythonError:{stack:e.t0.stack,message:e.t0.message}}),D(!1),e.t0;case 13:return a=f.globals.get("output_image4chan"),r=a.getBuffer("u8"),a.destroy(),i=f.globals.get("output_width"),c=f.globals.get("output_height"),e.prev=18,o=new ImageData(new Uint8ClampedArray(r.data.buffer,r.data.byteOffset,r.data.byteLength),i,c),e.abrupt("return",o);case 21:return e.prev=21,r.release(),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[3,8],[18,,21,24]])})));return function(t){return e.apply(this,arguments)}}(),s({fn:r});case 11:case"end":return a.stop()}}),a)})))()}}),[f,n,t,i]);var g=Object(a.useState)(),m=Object(p.a)(g,2),w=m[0],C=m[1],P=Object(a.useState)(!1),E=Object(p.a)(P,2),S=E[0],D=E[1],F=Object(a.useCallback)((function(){return D(!0)}),[]),A=Object(a.useCallback)((function(){D(!1),C(void 0)}),[]),H=Object(a.useRef)(!1);H.current=S;var R=Object(a.useCallback)(function(){var e=Object(j.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=f){e.next=3;break}return console.log("Pyodide is not loaded"),e.abrupt("return");case 3:if(u){e.next=7;break}return console.log("Python packages have not been loaded."),C(t),e.abrupt("return");case 7:return e.next=9,u.fn(t);case 9:if(n=e.sent,H.current){e.next=13;break}return C(void 0),e.abrupt("return");case 13:C(n);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[f,u]);return function(e){var t=e.playing,n=e.videoConstraints,r=e.onFrame,i=Object(a.useRef)(r);i.current=r,Object(a.useEffect)((function(){if(t){var e=!1,a=document.createElement("video"),r=document.createElement("canvas"),c=r.getContext("2d");if(null==c)throw new Error("Failed to get a canvas context.");var o=void 0,u=function(){var t=Object(j.a)(b.a.mark((function t(){var n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=2;break}return t.abrupt("return");case 2:if(a.paused||a.currentTime===o){t.next=8;break}return o=a.currentTime,c.drawImage(a,0,0),n=c.getImageData(0,0,r.width,r.height),t.next=8,i.current(n);case 8:window.requestAnimationFrame(u);case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),s=null;return navigator.mediaDevices.getUserMedia({video:n,audio:!1}).then((function(t){e?x(t):(s=t,a.onloadedmetadata=function(){e||(r.width=a.videoWidth,r.height=a.videoHeight,a.play(),window.requestAnimationFrame(u))},a.srcObject=s)})),function(){e=!0,a.pause(),a.remove(),r.remove(),s&&x(s)}}}),[t,n])}({playing:S,videoConstraints:!0,onFrame:R}),Object(d.jsxs)(y.a,{children:[Object(d.jsxs)(y.a,{position:"relative",display:"inline-block",children:[S&&!u&&Object(d.jsx)(y.a,{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:Object(d.jsx)(O.a,{size:80})}),Object(d.jsx)(y.a,{children:w&&Object(d.jsx)(k,{imageData:w})})]}),Object(d.jsx)(y.a,{children:S?Object(d.jsx)(v.a,{variant:"contained",onClick:A,children:"Stop"}):Object(d.jsx)(v.a,{variant:"contained",onClick:F,children:"Play"})})]})};c.a.render(Object(d.jsxs)(r.a.StrictMode,{children:[Object(d.jsx)(o.a,{}),Object(d.jsx)(l.StreamlitProvider,{children:Object(d.jsx)(f,{children:Object(d.jsx)(g,{children:Object(d.jsx)(C,{})})})})]}),document.getElementById("root"))}},[[69,1,2]]]);
//# sourceMappingURL=main.4a209f05.chunk.js.map