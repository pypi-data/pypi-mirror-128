"use strict";(self.webpackChunk_tiledb_inc_tiledb_plot_widget=self.webpackChunk_tiledb_inc_tiledb_plot_widget||[]).push([[568],{5268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(e,t)=>{let i;return(...s)=>new Promise((l=>{i&&clearTimeout(i),i=setTimeout((()=>l(e(...s))),t)}))}},1568:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return l(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const a=i(7708);n(i(8657),t);const r=o(i(1367)),d=i(8657),u={id:"@tiledb-inc/tiledb-plot-widget:plugin",requires:[a.IJupyterWidgetRegistry],autoStart:!0,activate:(e,t)=>{t.registerWidget({name:d.MODULE_NAME,version:d.MODULE_VERSION,exports:r})}};t.default=u},5879:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.poll=void 0,t.poll=function(e,t=2e3,i=100){const s=Number(new Date)+t,l=function(t,n){const o=e();o?t(o):Number(new Date)<s?setTimeout(l,i,t,n):n(new Error("timed out for "+e+": "))};return new Promise(l)}},8657:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MODULE_NAME=t.MODULE_VERSION=void 0;const s=i(4147);t.MODULE_VERSION=s.version,t.MODULE_NAME=s.name},1367:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&s(t,e,i);return l(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DagVisualizeView=t.DagVisualizeModel=void 0;const a=i(7708),r=n(i(3541)),d=o(i(5268)),u=o(i(4658)),c=i(8657),p=i(5879);class b extends a.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:b.model_name,_model_module:b.model_module,_model_module_version:b.model_module_version,_view_name:b.view_name,_view_module:b.view_module,_view_module_version:b.view_module_version,value:""})}}t.DagVisualizeModel=b,b.serializers=Object.assign({},a.DOMWidgetModel.serializers),b.model_name="DagVisualizeModel",b.model_module=c.MODULE_NAME,b.model_module_version=c.MODULE_VERSION,b.view_name="DagVisualizeView",b.view_module=c.MODULE_NAME,b.view_module_version=c.MODULE_VERSION;class m extends a.DOMWidgetView{render(){this.el.classList.add("tiledb-widget"),this.createSVG(),this.value_changed();const e=d.default(this.value_changed.bind(this),1500);this.model.on("change:value",e,this)}value_changed(){this.data=JSON.parse(this.model.get("value")),this.createDag()}calculateBounds(e){if(void 0===this.bounds){const t=Object.keys(e).map((t=>e[t][0])),i=Object.keys(e).map((t=>e[t][1])),s=30,l=60,n=Math.max(...t),o=Math.max(...i);this.bounds=[n+s,o+l]}return this.bounds}createSVG(){this.wrapper=r.select(this.el).append("svg").append("g"),this.svg=r.select(this.el).select("svg"),this.createControls(),this.createTooltip()}getScale(){const[e,t]=this.bounds;return[this.el.offsetWidth/(e+40),400/(t+40)]}zoom(){const[e,t]=this.bounds,[i,s]=this.getScale(),l=this.svg,n=r.zoom().translateExtent([[0,0],[e*i+40,t*s+40]]).on("zoom",(()=>{this.wrapper.attr("transform",r.event.transform)}));function o(){r.event.preventDefault();const e="zoom_in"===this.id?.2:-.2;l.transition().duration(300).call(n.scaleBy,1+e)}function a(){l.transition().duration(300).call(n.transform,r.zoomIdentity)}l.call(n).on("wheel.zoom",null),setTimeout((()=>{r.select(this.el).selectAll(".zoomControl").on("click",o),r.select(this.el).selectAll(".resetControl").on("click",a)}),0),this.initialized=!0}createTooltip(){this.tooltip=r.select(this.el).append("div").attr("class","tooltip").style("opacity",0)}calculateYOffset(e,t,i){if(void 0===this.verticalOffset){const s=e.find((e=>Boolean(e.parent&&e.parent.id===i))),l=s?s.y:0;this.verticalOffset=t-l/2}return this.verticalOffset}getRootNodes(e,t){return e.filter((e=>t.every((([,t])=>e!==t))))}getNodeSize(e){const t=Math.floor(e/10);return Math.max(320/(20+t),5)}async createDag(){const{nodes:e,edges:t,node_details:i,positions:s}=this.data,l=this.calculateBounds(s)[1];this.initialized||await p.poll((()=>this.el.offsetWidth>0),300);const n=e.length,o=n<30,[a,d]=this.getScale();this.positions=this.positions||s,this.initialized||this.zoom();const c=this.getNodeSize(n),b=t.map((([e,t])=>({source:e,target:t}))),m=Object.keys(i).map(((e,t)=>({index:t,status:i[e].status,id:e,fx:this.positions[e][0]*a,fy:(l-this.positions[e][1])*d}))),h=new Worker(u.default);h.postMessage({nodes:m,links:b}),h.onmessage=e=>{if("end"!==e.data.type)return;this.wrapper.selectAll("*").remove();const{nodes:t,links:i}=e.data;this.wrapper.append("g").selectAll("path").data(i).enter().append("path").attr("d",(e=>`M${e.source.x},${e.source.y} C ${e.source.x},${(e.source.y+e.target.y)/2} ${e.target.x},${(e.source.y+e.target.y)/2} ${e.target.x},${e.target.y}`)).attr("class",(e=>`path-${e.target.status}`)),this.wrapper.append("g").selectAll("circle").data(t).enter().append("circle").attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",c).attr("class",(e=>`${e.status} ${o?"node--small":""}`)).on("mouseover",(e=>{this.tooltip.transition().duration(200).style("opacity",.9),this.tooltip.html(`<p>${e.id}: ${e.status}</p>`).style("left",`${r.event.clientX+10}px`).style("top",`${r.event.clientY+10}px`)})).on("mouseout",(()=>{this.tooltip.transition().duration(500).style("opacity",0)}))}}createControls(){const e=document.createElement("button"),t=document.createElement("button"),i=document.createElement("button"),s="zoomControl";e.id="zoom_in",t.id="zoom_out",i.className="resetControl",e.className=s,t.className=s,this.el.append(e),this.el.append(t),this.el.append(i)}}t.DagVisualizeView=m},4658:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});const s=i.p+"8fa11702a05bb6dd0a6d97822fd899015f9b7189025cb63d02d6a351879b1558.js"},4147:e=>{e.exports=JSON.parse('{"name":"@tiledb-inc/tiledb-plot-widget","version":"1.0.1","description":"Custom Jupyterlab widget for TileDB","keywords":["jupyter","jupyterlab","jupyterlab-extension"],"homepage":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget","bugs":{"url":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget/issues"},"license":"MIT","author":{"name":"tiledb","email":"hello@tiledb.com"},"files":["lib/**/*.{d.ts,eot,gif,html,jpg,js,js.map,json,png,svg,woff2,ttf}","dist/*.js","style/**/*.{css,js,eot,gif,html,jpg,json,png,svg,woff2,ttf}","icons/*.svg"],"main":"lib/index.js","types":"lib/index.d.ts","style":"style/index.css","repository":{"type":"git","url":"https://github.com/TileDB-Inc/TileDB-Jupyter-Plot-Widget.git"},"scripts":{"build":"jlpm run build:lib && jlpm run build:labextension:dev","build:prod":"jlpm run clean && jlpm run build:lib && jlpm run build:labextension && jlpm run build:webpack","build:labextension":"jupyter labextension build .","build:labextension:dev":"jupyter labextension build --development True .","build:webpack":"webpack --mode=production","build:lib":"tsc","clean":"jlpm run clean:lib","clean:lib":"rimraf lib tsconfig.tsbuildinfo","clean:labextension":"rimraf tiledb/plot/widget/labextension","clean:all":"jlpm run clean:lib && jlpm run clean:labextension","eslint":"eslint . --ext .ts,.tsx --fix","eslint:check":"eslint . --ext .ts,.tsx","install:extension":"jlpm run build","watch":"run-p watch:src watch:labextension","watch:src":"tsc -w","watch:labextension":"jupyter labextension watch ."},"dependencies":{"@jupyter-widgets/base":"^4.0.0","@jupyterlab/application":"^3.1.0","d3":"^5.15.1"},"devDependencies":{"@jupyterlab/builder":"^3.1.0","@types/d3":"^5.7.2","@types/webpack-env":"^1.16.3","@typescript-eslint/eslint-plugin":"^4.8.1","@typescript-eslint/parser":"^4.8.1","eslint":"^7.14.0","eslint-config-prettier":"^6.15.0","eslint-plugin-prettier":"^3.1.4","git-tag-version":"^1.3.1","npm-run-all":"^4.1.5","prettier":"^2.1.1","rimraf":"^3.0.2","source-map-loader":"^3.0.0","style-loader":"^3.3.1","ts-loader":"9","typescript":"~4.1.3","webpack":"^5.64.4","webpack-cli":"^4.9.1"},"sideEffects":["style/*.css","style/index.js"],"styleModule":"style/index.js","publishConfig":{"access":"public"},"jupyterlab":{"extension":true,"outputDir":"tiledb/plot/widget/labextension","discovery":{"server":{"managers":["pip"],"base":{"name":"tiledb-plot-widget"}}}},"jupyter-releaser":{"hooks":{"before-build-npm":["python -m pip install jupyterlab~=3.1","jlpm"]}}}')}}]);